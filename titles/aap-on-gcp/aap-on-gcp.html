<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Ansible Automation Platform from GCP Marketplace guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left Role ARG Spec">
<div id="header">
<h1>Ansible Automation Platform from GCP Marketplace guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_ansible_automation_platform_from_gcp_marketplace">Ansible Automation Platform from GCP Marketplace</a></li>
<li><a href="#making-open-source-more-inclusive">Making open source more inclusive</a></li>
<li><a href="#assembly-intro-to-aap-on-gcp">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#con-gcp-application-architecture">1.1. Application architecture</a>
<ul class="sectlevel3">
<li><a href="#_service_descriptions">1.1.1. Service descriptions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-gcp-install">2. Installation</a>
<ul class="sectlevel2">
<li><a href="#ref-gcp-install-prerequisites">2.1. Prerequisites</a></li>
<li><a href="#con-gcp-create-project">2.2. Create a project</a>
<ul class="sectlevel3">
<li><a href="#con-gcp-required-apis">2.2.1. Required APIs</a></li>
<li><a href="#con-gcp-service-account">2.2.2. Create a service account</a></li>
<li><a href="#ref-gcp-install-permissions">2.2.3. Policies and permissions</a></li>
</ul>
</li>
<li><a href="#con-gcp-application-deploy">2.3. Application deployment</a>
<ul class="sectlevel3">
<li><a href="#proc-gcp-deploy-with-new-vpc">2.3.1. Deploying an application with a new VPC</a></li>
<li><a href="#proc-gcp-deploy-with-existing-vpc">2.3.2. Deploying an application with an existing VPC</a></li>
</ul>
</li>
<li><a href="#con-gcp-get-deployment-info">2.4. Deployment information</a>
<ul class="sectlevel3">
<li><a href="#proc-gcp-retrieve-admin-password">2.4.1. Retrieving the administration password</a></li>
<li><a href="#proc-gcp-retrieve-lb-addresses">2.4.2. Retrieving the load balancer addresses</a></li>
</ul>
</li>
<li><a href="#con-gcp-setup-at-deployment-time">2.5. Setting up monitoring and logging at deployment time</a></li>
<li><a href="#proc-gcp-deploying-extension-nodes">2.6. Deploying an extension node</a></li>
</ul>
</li>
<li><a href="#assembly-gcp-networking-access">3. Networking and application access</a>
<ul class="sectlevel2">
<li><a href="#ref-gcp-networking-options">3.1. Networking options</a></li>
<li><a href="#con-gcp-network-peering-options">3.2. Network peering options</a></li>
<li><a href="#proc-gcp-vpc-peering">3.3. VPC peering</a></li>
<li><a href="#proc-gcp-external-load-balancer">3.4. Using an external load balancer</a></li>
</ul>
</li>
<li><a href="#assembly-gcp-additional-configs">4. Additional configurations</a>
<ul class="sectlevel2">
<li><a href="#proc-gcp-additional-configs-update-admin-password">4.1. Changing the default administrator password</a></li>
<li><a href="#proc-gcp-additional-configs-replace-tls-certificate">4.2. Replacing automation controller and automation hub VM instances SSL/TLS certificate and key</a></li>
<li><a href="#proc-gcp-secure-communication-SSL">4.3. Securing internal communication with SSL</a></li>
<li><a href="#ref-gcp-security-considerations">4.4. Security considerations</a></li>
</ul>
</li>
<li><a href="#ap-command-generator">5. The command generator</a>
<ul class="sectlevel2">
<li><a href="#proc-aap-pull-command-container-image">5.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-aap-list-available-playbooks">5.2. Listing the available playbooks</a></li>
<li><a href="#proc-aap-generate-command-data-file">5.3. Generating the data file</a></li>
<li><a href="#proc-aap-populate-command-data-file">5.4. Populating the data file</a></li>
<li><a href="#proc-aap-run-generated-command">5.5. Running the generated command</a></li>
<li><a href="#ref-aap-using-playbooks">5.6. Using the playbooks</a></li>
</ul>
</li>
<li><a href="#assembly-gcp-automation-workloads">6. Automation workloads</a>
<ul class="sectlevel2">
<li><a href="#ref-gcp-automation-performance">6.1. Automation performance</a></li>
<li><a href="#ref-gcp-deployment-scaling">6.2. Deployment scaling</a></li>
<li><a href="#proc-gcp-extension-nodes">6.3. Purchasing an extension node</a></li>
</ul>
</li>
<li><a href="#assembly-gcp-monitoring-logging">7. Monitoring and logging</a>
<ul class="sectlevel2">
<li><a href="#con-gcp-setup-after-deployment">7.1. Setting up monitoring and logging after deployment</a>
<ul class="sectlevel3">
<li><a href="#con-gcp-use-container-image">7.1.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-gcp-generate-variables">7.1.2. Generating data files by running the ansible-on-clouds-ops container</a></li>
<li><a href="#proc-gcp-set-monitoring-logging-yml">7.1.3. Updating the data file</a></li>
<li><a href="#proc-gcp-generate-playbook">7.1.4. Generating the playbook</a></li>
</ul>
</li>
<li><a href="#con-gcp-customize-monitoring-logging">7.2. Customizing monitoring and logging</a>
<ul class="sectlevel3">
<li><a href="#ref-gcp-ansible-podman-config">7.2.1. Ansible and podman configuration</a></li>
<li><a href="#ref-gcp-configure-google-cloud-ops-agent">7.2.2. Google cloud ops agent configuration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-gcp-uninstall">8. Uninstalling</a>
<ul class="sectlevel2">
<li><a href="#proc-gcp-uninstall-application-uninstall">8.1. Uninstalling the application</a></li>
<li><a href="#proc-gcp-delete-extension-nodes">8.2. Deleting Extension Nodes</a></li>
<li><a href="#proc-gcp-delete-administration-secret">8.3. Deleting the administration secret</a></li>
<li><a href="#proc-gcp-delete-service-account">8.4. Deleting the service account</a></li>
<li><a href="#proc-gcp-delete-upgrade-secrets">8.5. Deleting secrets left over after upgrade, backup and restore</a></li>
<li><a href="#proc-gcp-delete-backup-leftovers">8.6. Deleting the filestore after backup</a></li>
<li><a href="#proc-gcp-delete-object-storage">8.7. Deleting the object storage bucket after backup</a></li>
</ul>
</li>
<li><a href="#assembly-aap-gcp-backup-and-recovery">9. Backup and Restore</a>
<ul class="sectlevel2">
<li><a href="#con-gcp-backup-process">9.1. The Backup Process</a>
<ul class="sectlevel3">
<li><a href="#proc-gcp-upgrade-pull-container-image_backup">9.1.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-gcp-setup-environment_backup">9.1.2. Setting up the environment</a></li>
<li><a href="#proc-gcp-backup-requirements">9.1.3. Backup requirements</a></li>
<li><a href="#proc-gcp-create-data-file">9.1.4. Creating the backup data file</a></li>
<li><a href="#ref-gcp-populate-backup-file">9.1.5. Parameters in the backup.yml file</a></li>
<li><a href="#proc-gcp-run-backup-playbook">9.1.6. Running the backup playbook</a></li>
<li><a href="#proc-gcp-listing-backups-playbook">9.1.7. List backups</a></li>
<li><a href="#proc-gcp-deleting-backups-playbook">9.1.8. Delete backups</a></li>
<li><a href="#proc-gcp-deleting-backups-troubleshooting-playbook">9.1.9. Fixing a failed backup deletion</a></li>
</ul>
</li>
<li><a href="#con-gcp-restore-process">9.2. Restore Process</a>
<ul class="sectlevel3">
<li><a href="#proc-gcp-upgrade-pull-container-image_restore">9.2.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#proc-gcp-setup-environment_restore">9.2.2. Setting up the environment</a></li>
<li><a href="#proc-gcp-generate-restore-yml-file">9.2.3. Generating the restore.yml file</a></li>
<li><a href="#“ref-gcp-populate-restore-file”">9.2.4. Parameters of the restore.yml file</a></li>
<li><a href="#ref-gcp-run-restore-command">9.2.5. Running the restore command</a></li>
<li><a href="#ref-failed-to-restore">9.2.6. Failure to restore</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#assembly-gcp-upgrade">10. Upgrading</a>
<ul class="sectlevel2">
<li><a href="#con-gcp-upgrade-backup-process">10.1. Backup before upgrade</a></li>
<li><a href="#con-gcp-upgrade-upgrading">10.2. Upgrade Ansible Automation Platform</a>
<ul class="sectlevel3">
<li><a href="#proc-gcp-upgrade-pull-container-image">10.2.1. Pulling the ansible-on-clouds-ops container image</a></li>
<li><a href="#ref-aws-iam-upgrade-minimum-permissions">10.2.2. Required permissions</a></li>
<li><a href="#proc-gcp-generate-upgrade-data-file">10.2.3. Generating the data file</a></li>
<li><a href="#ref-gcp-update-upgrade-data-file">10.2.4. Updating the data file</a></li>
<li><a href="#proc-gcp-running-upgrade">10.2.5. Running the upgrade playbook</a></li>
</ul>
</li>
<li><a href="#con-gcp-upgrade-restore-from-stack">10.3. Restore from backup</a></li>
</ul>
</li>
<li><a href="#assembly-gcp-support">11. Support</a>
<ul class="sectlevel2">
<li><a href="#ref-gcp-vm-image-packages">11.1. VM Image packages</a></li>
<li><a href="#ref-gcp-supported-changes">11.2. Supported infrastructure configuration changes</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Install and configure Ansible Automation Platform from GCP Marketplace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ansible_automation_platform_from_gcp_marketplace"><a class="anchor" href="#_ansible_automation_platform_from_gcp_marketplace"></a>Ansible Automation Platform from GCP Marketplace</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Thank you for your interest in Red Hat Ansible Automation Platform from GCP Marketplace.
Ansible Automation Platform is a commercial offering that helps teams manage complex multi-tier deployments by adding control, knowledge, and delegation to Ansible-powered environments.</p>
</div>
<div class="paragraph">
<p>This guide helps you to understand the installation and use of Ansible Automation Platform from GCP Marketplace.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="making-open-source-more-inclusive"><a class="anchor" href="#making-open-source-more-inclusive"></a>Making open source more inclusive</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Red Hat is committed to replacing problematic language in our code, documentation, and web properties.
We are beginning with these four terms: master, slave, blacklist, and whitelist.
Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases.
For more details, see <a href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright&#8217;s message</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Disclaimer</strong>: Links contained in this document to external website(s) are provided for convenience only. Red Hat has not reviewed the links and is not responsible for the content or its availability. The inclusion of any link to an external website does not imply endorsement by Red Hat of the website or their entities, products or services. You agree that Red Hat is not responsible or liable for any loss or expenses that may result due to your use of (or reliance on) the external site or content.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-intro-to-aap-on-gcp"><a class="anchor" href="#assembly-intro-to-aap-on-gcp"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is an offering that you can deploy from the <a href="https://console.cloud.google.com/marketplace">GCP Marketplace</a> portal.
Ansible Automation Platform from GCP Marketplace provides access to a library of Ansible content collections, and is integrated with key GCP services, so you can start automating the deployment, configuration, and management of infrastructure and applications quickly.</p>
</div>
<div class="paragraph">
<p>The following Red Hat Ansible Automation Platform components are available on Ansible Automation Platform from GCP Marketplace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.ansible.com/products/controller">Automation controller</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.2/html/getting_started_with_automation_hub/pr01">Ansible automation hub</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.1/html-single/managing_containers_in_private_automation_hub/index">Private automation hub</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.2/html-single/publishing_proprietary_content_collections_in_automation_hub/index">Ansible Content Collections</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.2/html-single/creating_and_consuming_execution_environments/index">Automation execution environments</a></p>
</li>
<li>
<p><a href="https://www.ansible.com/products/automation-platform">Ansible content tools, including access to Red Hat Insights for Red Hat Ansible Automation Platform</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Automation mesh is not available on Ansible Automation Platform from GCP Marketplace at this time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-gcp-application-architecture"><a class="anchor" href="#con-gcp-application-architecture"></a>1.1. Application architecture</h3>
<div class="paragraph">
<p>Red Hat Ansible Automation Platform from GCP Marketplace is installed into infrastructure resources running within your GCP account.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/aap-on-gcp-architecture.png" alt="GCP application architecture">
</div>
</div>
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace was designed to be private, with no public ingress enabled by default.
This requires customers to connect existing GCP infrastructure to Ansible Automation Platform infrastructure manually.
Ansible Automation Platform components that are deployed are isolated into their own VPC.
Applications then run on instances managed by an instance group, which run on RHEL-based Google Compute machine images.
These machine images are preloaded with required container images to run Ansible Automation Platform including automation hub, automation controller, and receptor rpm/container components.
A shared Google Filestore volume is mounted into each instance deployed by the instance group manager.</p>
</div>
<div class="paragraph">
<p>All GCP Compute instances have private IP addresses by default.
The Ansible Automation Platform applications are run in containers managed through podman on the instances.
This podman configuration is itself managed by systemd.
SELinux is enabled on GCP Compute instances and is supported down to the container level.
Each automation controller instance is configured as an Ansible Automation Platform hybrid node by default to simplify the scale up and out procedures.</p>
</div>
<div class="sect3">
<h4 id="_service_descriptions"><a class="anchor" href="#_service_descriptions"></a>1.1.1. Service descriptions</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Service Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Engine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP VM compute platform</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP database service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filestore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP file storage service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual Private Cloud (VPC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP networking service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Monitoring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP metrics collector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Logging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GCP log management Service</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-install"><a class="anchor" href="#assembly-gcp-install"></a>2. Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="ref-gcp-install-prerequisites"><a class="anchor" href="#ref-gcp-install-prerequisites"></a>2.1. Prerequisites</h3>
<div class="paragraph">
<p>Before you can install and register Ansible Automation Platform, you must be familiar with GCP including how services operate, how data is stored, and any privacy implications that may exist by using these services.
You must also set up an account with <em>Google Cloud Platform</em> (GCP).</p>
</div>
<div class="paragraph">
<p>You must have a working knowledge of the following aspects of Google Cloud Platform:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploying solutions from the GCP Marketplace</p>
</li>
<li>
<p>Compute engine <em>Virtual machine</em> (VM) instances</p>
</li>
<li>
<p>Cloud SQL for PostgreSQL</p>
</li>
<li>
<p>Filestore</p>
</li>
<li>
<p>GPC <em>Virtual Private Clouds</em> (VPCs)</p>
<div class="ulist">
<ul>
<li>
<p>Subnets</p>
</li>
<li>
<p>Route Tables</p>
</li>
<li>
<p>Load Balancers</p>
</li>
</ul>
</div>
</li>
<li>
<p>Network Design</p>
<div class="ulist">
<ul>
<li>
<p>Hub-and-spoke networking designs</p>
</li>
<li>
<p>VPC Peering</p>
</li>
<li>
<p><em>Class Inter-Domain Routing</em> (CIDR) blocks</p>
</li>
<li>
<p>Transit routing</p>
</li>
</ul>
</div>
</li>
<li>
<p>GCP Cloud monitoring</p>
<div class="ulist">
<ul>
<li>
<p>GCP Ops agent</p>
</li>
</ul>
</div>
</li>
<li>
<p>SSH</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about Google Cloud Platform and terminology, see the <a href="https://cloud.google.com//">GCP product documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-create-project"><a class="anchor" href="#con-gcp-create-project"></a>2.2. Create a project</h3>
<div class="paragraph">
<p>To install Ansible Automation Platform, you must create a project in your Google Cloud Platform account to host the application if you do not already have one.
See <a href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">Creating and managing projects</a> in the GCP documentation.</p>
</div>
<div class="sect3">
<h4 id="con-gcp-required-apis"><a class="anchor" href="#con-gcp-required-apis"></a>2.2.1. Required APIs</h4>
<div class="paragraph">
<p>Your Google Cloud Platform (GCP) project requires access to several API services to complete Ansible Automation Platform installation.
On marketplace deployment, the process automatically attempts to enable the following APIs.</p>
</div>
<div class="paragraph">
<p>If you prefer, you can enable the APIs ahead of time to ensure they are permitted by your organization.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">API Service</th>
<th class="tableblock halign-left valign-top">Console service name</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Engine API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compute.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google Cloud APIs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloudapis.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity and Access Management (IAM) API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iam.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud SQL Admin API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sql-component.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Logging API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logging.googleapis.com</code></p>
<p class="tableblock">See <a href="#assembly-gcp-monitoring-logging">Monitoring and logging</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Monitoring API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>monitoring.googleapis.com</code></p>
<p class="tableblock">See <a href="#assembly-gcp-monitoring-logging">Monitoring and logging</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Resource Manager API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cloudresourcemanager.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Identity-Aware Proxy API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iap.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret Manager API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>secretmanager.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Networking API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>servicenetworking.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Usage API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>serviceusage.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS Config API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>osconfig.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Runtime Configuration API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>runtimeconfig.googleapis.com</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Filestore API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>file.googleapis.com</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="con-gcp-service-account"><a class="anchor" href="#con-gcp-service-account"></a>2.2.2. Create a service account</h4>
<div class="paragraph">
<p>You must have a service account to set up Ansible Automation Platform from GCP Marketplace.
This account is used to install and configure the application and remains associated with the Ansible Automation Platform virtual machines.
You can use an existing service account with the required roles, or the Ansible Automation Platform deployment can create one with the required roles on your behalf.
If you use an existing account, or <a href="https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating">create a service account</a> in advance, it must have the following roles:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Editor</p>
</li>
<li>
<p>Logs Writer</p>
</li>
<li>
<p>Cloud SQL Client</p>
</li>
<li>
<p>Cloud SQL Instance User</p>
</li>
<li>
<p>Secret Manager Secret Accessor</p>
</li>
<li>
<p>Compute Network Admin</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://cloud.google.com/iam/docs/granting-changing-revoking-access#single-role">Grant a single role</a> for steps to add the required roles to your existing service account.</p>
</div>
<div class="paragraph">
<p>The Compute Network Administrator role is only required at the time of deployment to configure the application properly.
When installation and configuration are complete, this role can be removed from the service account, which remains configured on the Ansible Automation Platform Virtual Machines.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The secrets created during the deployment must be able to use the automatic replication policy.  The user specified replication policy is not supported and must be disabled during deployment, backup or upgrade.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="ref-gcp-install-permissions"><a class="anchor" href="#ref-gcp-install-permissions"></a>2.2.3. Policies and permissions</h4>
<div class="paragraph">
<p>Your GCP account must have the following <em>Identity and Access Management</em> (IAM) permissions to successfully create and manage Ansible Automation Platform deployments as well as the resources described in <a href="#con-gcp-application-architecture">Application architecture</a>.</p>
</div>
<div class="paragraph">
<p>Your GCP account must also be licensed to deploy Ansible Automation Platform from GCP Marketplace.</p>
</div>
<div class="paragraph">
<p>The application can fail to deploy if your IAM policies restrict deployment and management of these resources.</p>
</div>
<div class="paragraph">
<p>The application has two deployment options:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">For deployment with a new VPC</th>
<th class="tableblock halign-left valign-top">For deployment with an existing VPC</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Minimum Permissions</p>
<div class="ulist">
<ul>
<li>
<p>Cloud SQL Client</p>
</li>
<li>
<p>Cloud SQL Instance User</p>
</li>
<li>
<p>Compute Network Admin</p>
</li>
<li>
<p>Editor</p>
</li>
<li>
<p>Logs Writer</p>
</li>
<li>
<p>Secret Manager Secret Accessor</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Minimum Permissions</p>
<div class="ulist">
<ul>
<li>
<p>Cloud SQL Client</p>
</li>
<li>
<p>Cloud SQL Instance User</p>
</li>
<li>
<p>Compute Network Admin</p>
</li>
<li>
<p>Editor</p>
</li>
<li>
<p>Logs Writer</p>
</li>
<li>
<p>Secret Manager Secret Accessor</p>
</li>
</ul>
</div>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-application-deploy"><a class="anchor" href="#con-gcp-application-deploy"></a>2.3. Application deployment</h3>
<div class="paragraph">
<p>To launch your offer on the Google Cloud Console, navigate to the marketplace and search for <strong>Red Hat Ansible Automation Platform 2 - Up to 100 Managed Nodes</strong>. After selecting this offer click btn:[Launch].</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A temporary yet necessary constraint has been placed on the length of deployment names.
This is due to GCP&#8217;s naming scheme for internal components that make up an Ansible Automation Platform deployment.
Component names based on this naming scheme can get too long and often break naming constraints imposed by other services, creating deployment errors.</p>
</div>
<div class="paragraph">
<p>The length of the name of your deployment, plus the length of your GCP project name must be less than 35 characters and the length of the deployment name must be less than 30 characters.</p>
</div>
<div class="paragraph">
<p>The calculation below will help you find the maximum length of the name of an Ansible Automation Platform deployment in your project.</p>
</div>
<div class="paragraph">
<p>length of deployment name &lt; = (minimum between 30 and 35) - length(gcp project name)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two methods for deploying the application:</p>
</div>
<div class="sect3">
<h4 id="proc-gcp-deploy-with-new-vpc"><a class="anchor" href="#proc-gcp-deploy-with-new-vpc"></a>2.3.1. Deploying an application with a new VPC</h4>
<div class="paragraph">
<p>This procedure creates a new VPC network and deploys the application in the created VPC.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Deployment page, select the <strong>Service Usage API</strong> link below the <strong>Confirm Service Usage API is enabled</strong> checkbox.</p>
</li>
<li>
<p>In the <strong>API/Service Details</strong> tab, ensure that the API is enabled, then return to the Deployment page.</p>
</li>
<li>
<p>Check the <strong>Confirm Service Usage API</strong> is enabled checkbox.</p>
</li>
<li>
<p>Select or create a <strong>Service Account</strong>.
For further information see <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-gcp-install#con-gcp-service-account">Your service account</a>.</p>
</li>
<li>
<p>In the <strong>Region</strong> field, select the region where you want the application deployed.</p>
</li>
<li>
<p>In the <strong>Zone</strong> field, select the zone where you want the Filestore deployed.
The zone must be in the Region you selected.</p>
</li>
<li>
<p>In the <strong>Observability</strong> section, you can enable logging and metrics to be sent to Cloud Logging and Cloud Monitoring. See <a href="https://cloud.google.com/stackdriver/pricing">Operations Suite Pricing</a> for the financial cost of enabling these services. See See <a href="#assembly-gcp-monitoring-logging">Monitoring and logging</a> for more information on configuring this feature.</p>
</li>
<li>
<p>In the <strong>Network Selection</strong> section, select <strong>New network</strong>.
The Networking section provides defaults for all of the network ranges used in the deployment. If you want to modify these values, see <a href="#ref-gcp-networking-options">Networking Options</a>.</p>
</li>
<li>
<p>Optional: In the <strong>Additional Labels</strong> section, provide any additional label key and value pairs to be added to the GCP resources that are part of the deployment.</p>
</li>
<li>
<p>Click btn:[DEPLOY].</p>
</li>
<li>
<p>The Deployment Manager displays the running deployment.</p>
</li>
<li>
<p>The application begins provisioning.
It can take some time for the infrastructure and application to fully provision.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will see a warning on the deployment</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This deployment has resources from the Runtime Configurator service, which is in Beta</pre>
</div>
</div>
<div class="paragraph">
<p>This warning is expected and is not a cause for concern.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-deploy-with-existing-vpc"><a class="anchor" href="#proc-gcp-deploy-with-existing-vpc"></a>2.3.2. Deploying an application with an existing VPC</h4>
<div class="paragraph">
<p>The following procedure uses an existing VPC network to deploy an application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The existing proxy subnet must be of type <strong>Regional Managed Proxy</strong>, which is the reserved proxy-only subnet for load balancing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Deployment</strong> page, select the <strong>Service Usage API</strong> link below the <strong>Confirm Service Usage API is enabled</strong> checkbox.</p>
</li>
<li>
<p>In the <strong>API/Service Details</strong> tab, ensure that the API is enabled, then return to the <strong>Deployment</strong> page.</p>
</li>
<li>
<p>Check the <strong>Confirm Service Usage API</strong> is enabled checkbox.</p>
</li>
<li>
<p>Select or create a <strong>Service Account</strong>.
For further information, see <a href="#con-gcp-service-account">Your service account</a>.</p>
</li>
<li>
<p>In the <strong>Region</strong> field, select the region where you want the application deployed.</p>
</li>
<li>
<p>In the <strong>Zone</strong> field, select the zone where you want the Filestore deployed.
The zone must be in the Region you selected.</p>
</li>
<li>
<p>In the <strong>Observability</strong> section, you can enable logging and metrics to be sent to Cloud Logging and Cloud Monitoring. See <a href="https://cloud.google.com/stackdriver/pricing">Operations Suite Pricing</a> for the financial cost of enabling these services. See <a href="#assembly-gcp-monitoring-logging">Monitoring and logging</a> for more information on configuring this feature.</p>
</li>
<li>
<p>In the <strong>Network Selection</strong> section, select <strong>Existing network</strong>.</p>
</li>
<li>
<p>In the <strong>Existing Network</strong> section, provide your existing VPC network name, existing subnet name and existing proxy subnet name.
Select <strong>cloud NAT router</strong> to create a <strong>NAT router</strong> in your VPC network.</p>
</li>
<li>
<p>The <strong>Networking section</strong> provides defaults for all of the network ranges used in the deployment.
Provide these values based on your existing network configuration.
If you want to modify these values, see <a href="#ref-gcp-networking-options">Networking Options</a></p>
</li>
<li>
<p>Optional: In the <strong>Additional Labels</strong> section, provide any additional label key and value pairs to be added to the GCP resources that are part of the deployment.</p>
</li>
<li>
<p>Click btn:[DEPLOY].</p>
</li>
<li>
<p>The <strong>Deployment Manager</strong> displays the running deployment.</p>
</li>
<li>
<p>The application begins provisioning.
It can take some time for the infrastructure and application to fully provision.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You will see a warning on the deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>This deployment has resources from the Runtime Configurator service, which is in Beta.</pre>
</div>
</div>
<div class="paragraph">
<p>This warning is expected and is not a cause for concern.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-get-deployment-info"><a class="anchor" href="#con-gcp-get-deployment-info"></a>2.4. Deployment information</h3>
<div class="paragraph">
<p>After deploying Ansible Automation Platform, use the following procedures to retrieve information about your deployment.</p>
</div>
<div class="sect3">
<h4 id="proc-gcp-retrieve-admin-password"><a class="anchor" href="#proc-gcp-retrieve-admin-password"></a>2.4.1. Retrieving the administration password</h4>
<div class="paragraph">
<p>Use the following procedure to retrieve the administration password.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the GCP UI, select the main menu.</p>
</li>
<li>
<p>Select <strong>Security</strong>. If you do not see <strong>Security</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Secret Manager</strong>.</p>
</li>
<li>
<p>Filter with the name of the deployment. The secret name format is <code>&lt;DeploymentName&gt;-aap-admin</code>.</p>
</li>
<li>
<p>Click on the secret name of the deployment</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the deployment.</p>
</li>
<li>
<p>Select <strong>View secret value</strong>.
The administration password is displayed.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-retrieve-lb-addresses"><a class="anchor" href="#proc-gcp-retrieve-lb-addresses"></a>2.4.2. Retrieving the load balancer addresses</h4>
<div class="paragraph">
<p>Use the following procedure to retrieve the controller and hub IP address.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the GCP UI, select the main menu.</p>
</li>
<li>
<p>Select <strong>Deployment Manager</strong>.</p>
</li>
<li>
<p>Select <strong>Deployment</strong>.</p>
</li>
<li>
<p>Select the deployment name.</p>
</li>
<li>
<p>Select <strong>View Details</strong>.</p>
</li>
<li>
<p>In the right pane, under <strong>Deployment properties</strong>, find the <strong>Layout</strong> line.</p>
</li>
<li>
<p>Select <strong>View</strong>.
The <strong>Outputs:</strong> section shows the <strong>finalValue</strong> for the <strong>name</strong> controllerIp and hubIp.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-setup-at-deployment-time"><a class="anchor" href="#con-gcp-setup-at-deployment-time"></a>2.5. Setting up monitoring and logging at deployment time</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the GCP UI, navigate to menu:Observability[].</p>
</li>
<li>
<p>Check the <strong>Connect Logging</strong> and <strong>Connect Metrics</strong> checkboxes.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These checkboxes are only available in the foundation deployment.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-deploying-extension-nodes"><a class="anchor" href="#proc-gcp-deploying-extension-nodes"></a>2.6. Deploying an extension node</h3>
<div class="paragraph">
<p>You configure extension nodes after you have purchased and launched an extension from the public or private offer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Deployment name</strong> field, enter a sufficiently short name as described in <a href="#con-gcp-application-deploy">Application deployment</a>.</p>
</li>
<li>
<p>For the <strong>Service Account</strong>, select the service account used with your Red Hat Ansible Automation Platform with up to 100 Managed Nodes deployment.</p>
</li>
<li>
<p>In the <strong>Region</strong> field, select the region where you want the application deployed.</p>
</li>
<li>
<p>In the <strong>Zone</strong> field, select a zone in the <strong>Region</strong> you selected when deploying your foundational offer.
This field is only used to filter the Network list.</p>
</li>
<li>
<p>In the <strong>Main Deployment Name</strong> field, enter the foundation deployment name for which you are deploying an extension.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><strong>Main Deployment Name</strong> is a required field.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>In the <strong>Networking</strong> section, expand the default option.</p>
</li>
<li>
<p>In the <strong>Network</strong> field, select the existing foundation network ending with <code>-aap-net</code>.</p>
</li>
<li>
<p>In the <strong>Subnetwork</strong> field, select the existing foundation subnetwork ending with <code>-aap-subnet</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not select the subnet ending with <code>-aap-prxy-subnet</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ensure <strong>Extend Ansible Automation Platform deployment in selected VPC</strong> is checked.</p>
</li>
<li>
<p>Click btn:[DEPLOY].</p>
</li>
<li>
<p>The Deployment Manager displays the running deployment.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The extension begins provisioning.</p>
</div>
<div class="paragraph">
<p>It can take some time for the infrastructure and extension to fully provision.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-networking-access"><a class="anchor" href="#assembly-gcp-networking-access"></a>3. Networking and application access</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Ansible Automation Platform from GCP Marketplace is deployed, it is installed into an isolated VPC and cannot be accessed.
The following instructions describe how to connect the VPC used by Ansible Automation Platform from GCP Marketplace to your existing GCP network.
When connected, you must determine how your users connect to Ansible Automation Platform.</p>
</div>
<div class="paragraph">
<p>There are many ways to enable this connectivity such as VPNs, Google Cloud Interconnect, or bastion servers for private network access.
You can also expose the platform with public internet access using GCP services such as a Load Balancer.</p>
</div>
<div class="paragraph">
<p>How your organization configures application access on GCP is outside the scope of Red Hat’s guidelines and support for Ansible Automation Platform from GCP Marketplace.
For further information, see <a href="https://cloud.google.com/solutions/connecting-securely#external">Securely connecting to VMs</a> for guidelines on these topics.</p>
</div>
<div class="sect2">
<h3 id="ref-gcp-networking-options"><a class="anchor" href="#ref-gcp-networking-options"></a>3.1. Networking options</h3>
<div class="paragraph">
<p>The network topology of Ansible Automation Platform from GCP Marketplace includes several configurable network segments that can be changed to fit into your organization&#8217;s network requirements.</p>
</div>
<div class="paragraph">
<p>The deployment creates a new VPC and subnet that are not accessible from the public internet, or by using an existing VPC network.
You must provide access to the application as described in <a href="#assembly-gcp-networking-access">Networking and Application Access</a>.</p>
</div>
<div class="paragraph">
<p>Consider your existing network configurations when specifying the following network ranges below.
Ensure that each range does not overlap with any other specified here, and does not overlap with existing ranges in your network.
Each range should exist within a private network class.</p>
</div>
<div class="paragraph">
<div class="title"><strong>Application Subnet Range</strong></div>
<p>The network CIDR defining the subnet range used by the custom VPC deployed by the offering.
Must be a minimum <code>/24</code> segment and must be in the private network range (192.168 or 10.0).</p>
</div>
<div class="paragraph">
<p>Default: 192.168.240.0/24</p>
</div>
<div class="paragraph">
<div class="title"><strong>Cloud SQL Peering Network Range</strong></div>
<p>The network CIDR defines the network segment used to peer the GCP CloudSQL network with the application subnet deployed by the offering.
Must be a <code>/24</code> segment.
The <code>/24</code> segment range is a requirement of GCP CloudSQL network peering configuration.</p>
</div>
<div class="paragraph">
<p>Default: 192.168.241.0/24</p>
</div>
<div class="paragraph">
<div class="title"><strong>Filestore Peering Network Range</strong></div>
<p>Ansible Automation Platform from GCP Marketplace uses GCP Filestore service to share configuration files between multiple automation controller and automation hub VMs provisioned as part of the deployment.
This network CIDR range defines the peer network that is used by the offering to peer between the GCP Filestore network and the custom VPC application subnet of the offering.
Must be a minimum <code>/29</code> segment.</p>
</div>
<div class="paragraph">
<p>Default: 192.168.243.0/29</p>
</div>
<div class="paragraph">
<div class="title"><strong>Load Balancer Proxy Subnet Range</strong></div>
<p>Ansible Automation Platform from GCP Marketplace is deployed using GCP’s native cloud capabilities to provide a scalable and reliable installation.
As part of the Ansible Automation Platform from GCP Marketplace deployment topology two load balancers are deployed in front of the automation hub and automation controller VMs.
All traffic is directed at these load balancers and is proxied to the available backend VMs.
The deployment takes advantage of GCP’s native load balancing support enabling the customer to add additional ports (https) to the load balancers to capture and forward requests onto the backend VMs.
This also provides request balancing and session tracking for better reliability.
As part of the load balancer deployment, GCP requires creation of a special proxy network where GCP natively handles the redirection of requests to the backend VMs.
This special proxy network is not used within Ansible Automation Platform from GCP Marketplace for any other purpose than GCP’s load balancer’s proxy network requirement.
A <code>/24</code> segment is required.</p>
</div>
<div class="paragraph">
<p>Default: 192.168.242.0/24</p>
</div>
<div class="paragraph">
<div class="title"><strong>Controller Internal Load Balancer IP Address</strong></div>
<p>This is the static IP Address assigned to the automation controller Load Balancer.
This address must be within the Application Subnet Range segment.</p>
</div>
<div class="paragraph">
<p>Default: 192.168.240.20</p>
</div>
<div class="paragraph">
<div class="title"><strong>Hub Internal Load Balancer IP Address</strong></div>
<p>This is the static IP Address assigned to the automation hub Load Balancer.
This address must be within the Application Subnet Range segment.</p>
</div>
<div class="paragraph">
<p>Default: 192.168.240.21</p>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-network-peering-options"><a class="anchor" href="#con-gcp-network-peering-options"></a>3.2. Network peering options</h3>
<div class="paragraph">
<p>Many networking configurations to access the platform are possible, but the following configurations have been validated to work with Ansible Automation Platform from GCP Marketplace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While every effort has been made to align with Google Cloud Platform’s documentation for this content, there may be a drift in accuracy over time.
Use <a href="https://cloud.google.com/vpc/docs/vpc-peering">GCP documentation</a> as the source of information regarding networking topics for GCP.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-vpc-peering"><a class="anchor" href="#proc-gcp-vpc-peering"></a>3.3. VPC peering</h3>
<div class="paragraph">
<p><a href="https://cloud.google.com/vpc/docs/vpc-peering">VPC Peering</a> is required for Ansible Automation Platform to access resources that reside on private VPCs or where transit routing between Google Cloud Platform and your on-premises network(s) exists.
It offers the ability to directly connect different networks within your GCP infrastructure.
VPCs are individually connected to one another with no other routing hops between them.
VPC deployments omit access from the public internet by default.</p>
</div>
<div class="paragraph">
<p>This is also the deployment model for the GCP architecture used by Ansible Automation Platform from GCP Marketplace.</p>
</div>
<div class="paragraph">
<p>This is a simple peering model and is useful when connecting several networks.</p>
</div>
<div class="paragraph">
<p>Complex peering can be configured, but routing can become more complex over time.</p>
</div>
<div class="paragraph">
<p>When VPC peering and routing are configured, you can access Ansible Automation Platform through a VM on a connected VPC subnet, or directly if your organization has a transit routing setup between GCP and your local networks.</p>
</div>
<div class="paragraph">
<p>When two or more networks are peered, <a href="https://cloud.google.com/vpc/docs/vpc-peering#key_properties">Google performs automated actions</a> to assist with routing, but can perform routable updates to enable taffic flow within your GCP infrastructure.</p>
</div>
<div class="paragraph">
<div class="title">Prerequisites</div>
<p>Before using VPC peering to connect any VPC, you must ensure that there is no network address space overlap between the networks that you intend to route traffic between your VPCs and Ansible Automation Platform from GCP Marketplace&#8217;s VPC address space.
The GCP Portal should prevent peering if this is attempted.</p>
</div>
<div class="paragraph">
<p>Configure VPC peering with Ansible Automation Platform with the following procedure.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the GCP Portal, navigate to menu:VPC Network[].</p>
</li>
<li>
<p>In the <strong>VPC menu</strong>, select <strong>VPC Network Peering</strong>.</p>
</li>
<li>
<p>Click btn:[Create peering connection].</p>
</li>
<li>
<p>In the <strong>Name</strong> field, enter the name of the peering connection that you need.</p>
</li>
<li>
<p>In the <strong>Your VPC Network</strong> field, select the first VPC that you plan to peer.</p>
</li>
<li>
<p>In the <strong>Peered VPC Network</strong> field, select the second VPC to peer.
This must be the Ansible Automation Platform from GCP Marketplace VPC.</p>
<div class="ulist">
<ul>
<li>
<p>Subnet routes between these two networks are created by default.
Therefore, access to Ansible Automation Platform can occur from VMs that reside on the peered VPC.
However, if you have more complex routing, such as a hub-and-spoke network model, then other routes must be created.</p>
</li>
<li>
<p>Select <strong>Exchange custom routes</strong> and <strong>Exchange subnet routes with public IP</strong> carefully.
Google provides explanations what each fields does.
Your selection affects how traffic flows through your VPCs.
Normally, these checkboxes configure routing between the newly peered networks and other networks through the route table exchange and enable network traffic to traverse multiple networks (transit routing).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[Create].</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For additional information on routing tables, firewalls and other networking components regarding VPC Peering, see the <a href="https://cloud.google.com/vpc/docs">GCP documentation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-external-load-balancer"><a class="anchor" href="#proc-gcp-external-load-balancer"></a>3.4. Using an external load balancer</h3>
<div class="paragraph">
<p>It is possible to expose Ansible automation controller and Ansible private automation hub to the public internet if you want users to have access to the platform from any internet connected machine.</p>
</div>
<div class="paragraph">
<p>This is not recommended as a best practice for security reasons.</p>
</div>
<div class="paragraph">
<p>However this implementation can be secured with different GCP tools.
This section describes how to connect a load balancer that faces the public internet, but it does not include steps to harden access through Google’s security products.
Only use this approach if you intend to protect the public endpoints with <a href="https://cloud.google.com/armor/">Google Cloud Armor</a> or similar product(s).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is deployed with two <em>internal</em> application load balancers.
These load balancers direct traffic within local VPCs and must remain part of the deployment even if you configure public load balancers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Network Services</strong>.
If you do not see <strong>Network Services</strong>, then select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Load Balancing</strong>.</p>
</li>
<li>
<p>In the top menu, select <strong>CREATE LOAD BALANCER</strong>.</p>
</li>
<li>
<p>Select the <strong>HTTP(S) Load Balancing</strong> tile and click btn:[START CONFIGURATION].</p>
</li>
<li>
<p>Select <strong>From Internet to my VMs or serverless services</strong> and <strong>Global HTTP(s) Load Balancer</strong>.</p>
</li>
<li>
<p>Click btn:[CONTINUE].</p>
</li>
<li>
<p>Give your load balancer a name, for example, <code>&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb</code></p>
</li>
<li>
<p>Ensure that <strong>Frontend</strong> configuration is selected at the left of the screen.</p>
</li>
<li>
<p>On the <strong>Frontend</strong> configuration page, complete the following fields:</p>
<div class="ulist">
<ul>
<li>
<p><strong>Protocol</strong>: HTTPS.</p>
</li>
<li>
<p><strong>Port</strong>: 443.</p>
</li>
<li>
<p><strong>IP Address</strong>: Select an existing IP address or create a new one.</p>
</li>
<li>
<p><strong>Certificate</strong>: You can use your own SSL Certificate or use a Google managed certificate.</p>
</li>
<li>
<p><strong>SSL Policy</strong>: GCP default, or another configured policy.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[DONE].</p>
</li>
<li>
<p>Select <strong>Backend configuration</strong> from the menu on the left.</p>
</li>
<li>
<p>Click the <strong>Backend services &amp; backend buckets</strong> drop-down.</p>
</li>
<li>
<p>Click btn:[CREATE A BACKEND SERVICE].</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Give your backend service a name, for example, <code>&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb-bknd-svc</code></p>
</li>
<li>
<p>Set <strong>Backend type</strong> to <strong>Instance group</strong>.</p>
</li>
<li>
<p>Set <strong>Protocol</strong> to <code>HTTPS</code> and <strong>Named Port</strong> to <code>https</code>.</p>
</li>
<li>
<p>Change <strong>Timeout</strong> to <code>300</code>.</p>
</li>
<li>
<p>Scroll down to the <strong>Backends</strong> section and in the <strong>New backend</strong> field, select the <strong>Instance group</strong> drop-down.
Select the correct instance group.</p>
<div class="paragraph">
<p>For the automation controller load balancer, the correct instance group has the suffix <code>-aap-cntrlr-igm</code>.</p>
</div>
<div class="paragraph">
<p>For the automation hub load balancer, the correct instance group has the suffix <code>-aap-hub-igm</code>.</p>
</div>
</li>
<li>
<p>In the resulting dialog box, select <strong>USE EXISTING PORT NAME</strong>.</p>
</li>
<li>
<p>Set <strong>Balancing mode</strong> to <strong>Rate</strong>.</p>
</li>
<li>
<p>Set <strong>Maximum RPS</strong> to 300.</p>
</li>
<li>
<p>Scroll down until you see a text box showing <strong>Health check</strong>.</p>
</li>
<li>
<p>Select the drop-down menu and click btn:[CREATE A HEALTH CHECK].</p>
</li>
<li>
<p>Enter a name for your health check, for example, <code>&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb-hc</code></p>
</li>
<li>
<p>For automation controller, use the following health check settings</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Health Check</strong> dialog box, set <strong>Protocol</strong> to <code>TCP</code>, and <strong>Port</strong> to <code>8052</code>.</p>
</li>
<li>
<p>Set <strong>Request</strong> to <code>/api/v2/ping/</code>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>For automation hub, use the following health check settings</p>
<div class="ulist">
<ul>
<li>
<p>In the <strong>Health Check</strong> dialog box, set <strong>Protocol</strong> to <code>TCP</code>, and <strong>Port</strong> to <code>8080</code>.</p>
</li>
<li>
<p>Set <strong>Request</strong> to <code>/api/galaxy/pulp/api/v3/status/</code>.</p>
</li>
<li>
<p>Keep all other default settings.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click btn:[SAVE].</p>
<div class="paragraph">
<p>This returns you to the <strong>Backend services &amp; backend buckets</strong> window.</p>
</div>
</li>
<li>
<p>Click btn:[CREATE].</p>
<div class="paragraph">
<p>This returns you to <strong>Backend configuration</strong> section.</p>
</div>
</li>
<li>
<p>Click btn:[OK].</p>
</li>
<li>
<p>Click btn:[CREATE] to create the load balancer for the automation controller or automation hub UI.
This will take a few minutes to complete.</p>
</li>
</ol>
</div>
</li>
<li>
<p>A load balancer has now been created.</p>
</li>
<li>
<p>Configure the DNS record for the domain that you used in your SSL certificate to point to the IP address of the load balancer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point you should have accesss to the Ansible Automation Platform automation controller UI.
You can log in after you retrieve the administration password.</p>
</div>
<div class="paragraph">
<p>Repeat the same process for private automation hub.
The process is identical except for selecting the instance group <code>-aap-hub-igm</code> during backend configuration.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-additional-configs"><a class="anchor" href="#assembly-gcp-additional-configs"></a>4. Additional configurations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following chapter describes Ansible Automation Platform configuration steps that you can perform once your deployment is complete on GCP.</p>
</div>
<div class="sect2">
<h3 id="proc-gcp-additional-configs-update-admin-password"><a class="anchor" href="#proc-gcp-additional-configs-update-admin-password"></a>4.1. Changing the default administrator password</h3>
<div class="paragraph">
<p>The default administrator password for Ansible Automation Platform is generated randomly when Ansible Automation Platform from GCP Marketplace is deployed.
Follow these steps to change the administrator password for both automation controller and automation hub.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the GCP Secrets Manger Console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the Ansible Automation Platform deployment with the name <code><strong>&lt;deployment_name&gt;</strong>-aap-admin</code>.</p>
</li>
<li>
<p>Select <strong>NEW VERSION</strong> to add a new version.</p>
</li>
<li>
<p>Enter a password secret value.</p>
</li>
<li>
<p>Check <strong>Disable all past versions</strong> checkbox.</p>
</li>
<li>
<p>Click btn:[ADD NEW VERSION].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Change the running Ansible Automation Platform VM instances to use the new administrator password.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the <strong>GCP VM Instances</strong> console.</p>
</li>
<li>
<p>Identify and delete one automation controller VM instance and one automation hub VM instance for the Ansible Automation Platform deployment.</p>
</li>
<li>
<p>Wait for the automation controller and automation hub Instance groups to create new VM instances.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The new administrator password can be used when the new automation controller and automation hub VM instances reach a <em>Running</em> Instance State.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-additional-configs-replace-tls-certificate"><a class="anchor" href="#proc-gcp-additional-configs-replace-tls-certificate"></a>4.2. Replacing automation controller and automation hub VM instances SSL/TLS certificate and key</h3>
<div class="paragraph">
<p>By default, VM instances are secured with a self-signed SSL/TLS certificate with a validity period of ten years.
When the certificate expires or you want VM instances to use your own certificate, you are required to replace the SSL/TLS certificate and key.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the GCP Secrets Manger Console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the Ansible Automation Platform deployment with the name <code><strong>&lt;deployment_name&gt;</strong>-pulp_cert</code>.</p>
</li>
<li>
<p>Select <strong>NEW VERSION</strong> to add a new version.</p>
</li>
<li>
<p>Enter new SSL/TLS certificate value.</p>
</li>
<li>
<p>Check <strong>Disable all past versions</strong> checkbox.</p>
</li>
<li>
<p>Click btn:[ADD NEW VERSION].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Navigate to the GCP Secrets Manger Console.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Locate and open the secret for the Ansible Automation Platform deployment with the name <code><strong>&lt;deployment_name&gt;</strong>-pulp_key</code>.</p>
</li>
<li>
<p>Select <strong>NEW VERSION</strong> to add a new version.</p>
</li>
<li>
<p>Enter new SSL/TLS key value.</p>
</li>
<li>
<p>Check <strong>Disable all past versions</strong> checkbox.</p>
</li>
<li>
<p>Click btn:[ADD NEW VERSION].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Change the running Ansible Automation Platform VM instances to use the new SSL/TLS certificate and key.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to the <strong>GCP VM Instances</strong> console.</p>
</li>
<li>
<p>Identify and delete all automation controller and automation hub VM instances for the Ansible Automation Platform deployment.</p>
</li>
<li>
<p>Wait for the automation controller and automation hub Instance groups to create new VM instances.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The new certificate is in use when the new automation controller and automation hub VM instances reach a <em>Running</em> Instance State.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-secure-communication-SSL"><a class="anchor" href="#proc-gcp-secure-communication-SSL"></a>4.3. Securing internal communication with SSL</h3>
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is deployed with two <em>internal</em> application load balancers, one each in front of the hub and controller instances.
These internal load balancers must be configured with SSL certificates after deployment completes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Securing traffic through these internal load balancers is different than securing traffic through external load balancers in previous steps.
This process ensures HTTP traffic is encrypted even when the traffic is localized to private GCP VPCs.
The same procedure can be followed for both the automation controller and automation hub load balancers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To modify both the automation controller and automation hub load balancers, which have the name format <code>&lt;DEPLOYMENT_NAME&gt;-aap-&lt;cntrlr/hub&gt;-int-lb</code>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the GCP console, navigate to the <a href="https://console.cloud.google.com/net-services/loadbalancing/list/loadBalancers"><strong>Load Balancing</strong></a> page.</p>
</li>
<li>
<p>In the search bar, enter the name of your deployed image name to filter down to your load balancers.</p>
</li>
<li>
<p>Click btn:[Edit].</p>
</li>
<li>
<p>Click btn:[Frontend configuration].</p>
</li>
<li>
<p>Click btn:[ADD FRONTEND IP AND PORT].
Use the following values:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Protocol</strong>: HTTPS (includes HTTP/2).</p>
</li>
<li>
<p><strong>Subnetwork</strong>: Select the available aap-subnet.</p>
</li>
<li>
<p><strong>Port</strong>: 443</p>
</li>
<li>
<p><strong>IP Address</strong>: <code>&lt;DEPLOYMENT_NAME&gt;-aap&lt;cntrlr/hub&gt;-intl-lb-ip</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>If you have already added your certificate, select it.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If you have not added your certificate, click btn:[CREATE A NEW CERTIFICATE].</p>
</li>
<li>
<p>Provide a name for your certificate.</p>
</li>
<li>
<p>Using your previously generated certificate, copy its contents and paste it under <strong>Certificate</strong>.</p>
</li>
<li>
<p>Using your previously generated certificate key, copy its contents and paste it under <strong>Private Key</strong>.</p>
</li>
<li>
<p>Click btn:[Create].</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click btn:[Done].</p>
</li>
<li>
<p>Optional: To delete the HTTP Frontend configuration.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open the Load balancer instance.</p>
</li>
<li>
<p>Click btn:[Frontend Configuration]
The configurations appear on the left side of the UI.</p>
</li>
<li>
<p>Scroll to the configuration you want to delete.</p>
</li>
<li>
<p>Click the trashcan icon to delete the configuration.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Click btn:[Update], and confirm the update.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-gcp-security-considerations"><a class="anchor" href="#ref-gcp-security-considerations"></a>4.4. Security considerations</h3>
<div class="paragraph">
<p>To configure Red Hat Single Sign-On with an identity provider that can enable <em>Multi factor Authentication</em> (MFA), follow the steps <a href="https://docs.ansible.com/automation-controller/latest/html/administration/ent_auth.html">here</a> for connecting enterprise authentication to Ansible Automation Platform.</p>
</div>
<div class="paragraph">
<p>Securing infrastructure services is an important step in any cloud deployment.
Follow the implementation and security suggestions from <a href="https://cloud.google.com/docs">GCP documentation</a> for services used as part of an Ansible Automation Platform from GCP Marketplace deployment.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ap-command-generator"><a class="anchor" href="#ap-command-generator"></a>5. The command generator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Command Generator is used to generate commands for launching operational playbooks provided by the Ansible-on-clouds operational playbook collection.</p>
</div>
<div class="paragraph">
<p>The process involves five steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pull the <code>ansible-on-clouds-ops</code> container image.</p>
</li>
<li>
<p>List the available playbooks.</p>
</li>
<li>
<p>Use a command generator to generate a data file and the next command to run.
<code>command_generator_vars</code> and the command_generator are implemented using a docker container and are run using the docker command line interface.</p>
</li>
<li>
<p>Populate the data file and run the previous generated command.
This generates the final command with all parameters.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When this step is complete, you can save the generated command and run the playbook when it is required.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the final command.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Docker</p>
</li>
<li>
<p>A GCP credentials file</p>
</li>
<li>
<p>An internet connection to Google Cloud</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="proc-aap-pull-command-container-image"><a class="anchor" href="#proc-aap-pull-command-container-image"></a>5.1. Pulling the ansible-on-clouds-ops container image</h3>
<div class="paragraph">
<p>Pull the Docker image for the Ansible on Clouds operational container with the same tag version as your deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before Pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if your foundation deployment version is 2.4.20230630-00, you must pull the operational image with tag 2.4.20230630.</p>
</div>
<div class="paragraph">
<p>Use the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
<div class="paragraph">
<p>For EMEA regions (Europe, Middle East, Africa) run the following command instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-emea-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-list-available-playbooks"><a class="anchor" href="#proc-aap-list-available-playbooks"></a>5.2. Listing the available playbooks</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>For the list of available playbooks without details, use the following command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars | grep Playbook

The current version of the operational playbooks collection contains the following playbooks:

Playbook: aws_add_extension_nodes
Playbook: aws_add_labels
Playbook: aws_backup_stack
Playbook: aws_check_aoc_version
Playbook: aws_deployment_inventory
Playbook: aws_get_aoc_version
Playbook: aws_remove_extension_nodes
Playbook: aws_remove_labels
Playbook: aws_restore_stack
Playbook: aws_upgrade
Playbook: gcp_aap_health_check
Playbook: gcp_add_extension_nodes
Playbook: gcp_add_labels
Playbook: gcp_backup_delete
Playbook: gcp_backup_deployment
Playbook: gcp_backup_list
Playbook: gcp_backups_delete
Playbook: gcp_check_aoc_version
Playbook: gcp_create_external_load_balancer
Playbook: gcp_delete_external_load_balancer
Playbook: gcp_deployment_inventory
Playbook: gcp_get_aoc_version
Playbook: gcp_health_check
Playbook: gcp_list_deployments
Playbook: gcp_nodes_health_check
Playbook: gcp_remove_extension_nodes
Playbook: gcp_remove_labels
Playbook: gcp_restore_deployment
Playbook: gcp_setup_logging_monitoring
Playbook: gcp_upgrade</pre>
</div>
</div>
</li>
<li>
<p>To provide a list of all available playbooks, and to use the command generator, use the following command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars</pre>
</div>
</div>
<div class="paragraph">
<p>This provides a list of playbooks and a command similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_upgrade
Description: Performs the upgrade of the Ansible Automation Platform from GCP Marketplace components to the latest version.
-----------------------------------------------
Performs the upgrade of the Ansible Automation Platform from GCP Marketplace components to the latest version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_upgrade [--ansible-config ansible_config_path&gt;] \
-d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_backup_taken=&lt;true|false&gt;'
===============================================</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-generate-command-data-file"><a class="anchor" href="#proc-aap-generate-command-data-file"></a>5.3. Generating the data file</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the command generator.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v &lt;local_directory_data_file&gt;:/data $IMAGE command_generator_vars &lt;playbook_name&gt; --output-data-file /data/&lt;data-file&gt;.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The outputs of this command are the command to run and the data file template.
The data file is also saved in your <code>&lt;local_data_file_directory&gt;</code>.
This is the template which you populate with your data.</p>
</div>
<div class="paragraph">
<p>The following example uses the <code>gcp_backup_deployment</code> playbook.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator_vars gcp_backup_deployment \
--output-data-file /data/backup.yml</pre>
</div>
</div>
</li>
<li>
<p>Producing the following output.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_backup_deployment
Description: This playbook is used to backup the AoC Self-managed GCP environment.
-----------------------------------------------
This playbook is used to backup the AoC Self-managed GCP environment.
For more information regarding backup and restore, visit our official documentation -

-----------------------------------------------
Command generator template:

docker run --rm -v /tmp:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml

Data template:

gcp_backup_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_bucket_backup_name:
    gcp_compute_region:
    gcp_compute_zone:

===============================================</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-populate-command-data-file"><a class="anchor" href="#proc-aap-populate-command-data-file"></a>5.4. Populating the data file</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Edit the data-file generated in <a href="#proc-aap-generate-command-data-file">Generating the data file</a>.</p>
<div class="paragraph">
<p>Any attribute that represents a path must be an absolute path.
The <code>command_generator</code> automatically mounts a volume for it in the final command.</p>
</div>
<div class="paragraph">
<p>For example, in the case of the <code>gcp_backup_deployment</code> playbook, the file becomes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_backup_deployment
  cloud_credentials_path: /path/to/credentials
  deployment_name: my-deployment
  extra_vars:
    cp_bucket_backup_name: my-bucket
    gcp_compute_region: us-east1
    gcp_compute_zone: us-east1-b</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="proc-aap-run-generated-command"><a class="anchor" href="#proc-aap-run-generated-command"></a>5.5. Running the generated command</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Ensure that the mounted volume points to the directory where the data file is.</p>
<div class="paragraph">
<p>For the <code>gcp_backup_deployment</code> playbook example, this is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v /tmp:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Command to run playbook:

$ docker run --rm --env PLATFORM=GCP -v /path/to/credentials:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE\ redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=my-deployment gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b'</pre>
</div>
</div>
<div class="paragraph">
<p>This new command has the required parameters, environment variables and mounted volumes to run the playbook.</p>
</div>
</li>
<li>
<p>Run the generated command.
You can save this command to rerun it later if required.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="ref-aap-using-playbooks"><a class="anchor" href="#ref-aap-using-playbooks"></a>5.6. Using the playbooks</h3>
<div class="paragraph">
<p>The playbooks are explained in different chapters of this documentation but not all of them.
Here, those which are used either to retrieve information from the Ansible on Clouds deployment or to check it are described. These playbooks do not modify the deployment.</p>
</div>
<h4 id="_gcp_aap_health_check" class="discrete">gcp_aap_health_check</h4>
<div class="paragraph">
<p>This playbook checks if the Ansible application is healthy.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_aap_health_check</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_aap_health_check
Description: This playbook checks if the deployment is healthy using the Ansible health service.
-----------------------------------------------
The health check consists of checking the Ansible Automation Platform from GCP Marketplace environemnt to verify it is healthy.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_aap_health_check [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=29   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero indicates an issue with Ansible on Cloud deployment.</p>
</div>
<h4 id="_gcp_add_labels" class="discrete">gcp_add_labels</h4>
<div class="paragraph">
<p>This playbook adds labels to the deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_add_labels</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_add_labels
Description: This playbook adds labels to the deployment.
-----------------------------------------------
Add labels to the Ansible Automation Platform from GCP Marketplace deployment.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_add_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_labels=&lt;gcp_labels&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>The parameter <code>gcp_labels</code> is a comma separated list of <code>key=value</code> pairs to add or update.</p>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre>
</div>
</div>
<h4 id="_gcp_check_aoc_version" class="discrete">gcp_check_aoc_version</h4>
<div class="paragraph">
<p>This playbook checks if the Ansible on Cloud version is the same as the command generator container.
The check is done each time a playbook is called.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_check_aoc_version</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_check_aoc_version
Description: Check the operational container version matches the Ansible on Clouds version.
-----------------------------------------------
Check the operational container version matches the Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_check_aoc_version [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt;
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [redhat.ansible_on_clouds.standalone_check_aoc_version : Verify operational playbook and Ansible on Clouds deployment versions] ***
ok: [localhost] =&gt; {
    "changed": false,
    "msg": "This operation playbook version and the Ansible on Clouds deployment version are identical: 2.4.20230606-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero means the Ansible on Clouds deployment version does not match the <code>command_generator</code> container and a different version is required for the command generator to manage that deployment.</p>
</div>
<h4 id="_gcp_get_aoc_version" class="discrete">gcp_get_aoc_version</h4>
<div class="paragraph">
<p>This playbook retrieves the version of the Ansible on Clouds deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_get_aoc_version</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_get_aoc_version
Description: Get the current Ansible on Clouds version.
-----------------------------------------------
Get the current Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_get_aoc_version [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt;
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [Print version] ***********************************************************
ok: [localhost] =&gt; {
    "msg": "The AOC version is 2.4.20230606-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<h4 id="_gcp_check_aoc_version_2" class="discrete">gcp_check_aoc_version</h4>
<div class="paragraph">
<p>This playbook checks if the Ansible on Cloud version is the same as the command generator container.
The check is done each time a playbook is called.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_check_aoc_version</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_check_aoc_version
Description: Retrieve the Ansible on Clouds version.
-----------------------------------------------
Retrieve the Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_check_aoc_version [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt;
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [redhat.ansible_on_clouds.standalone_check_aoc_version : Verify operational playbook and Ansible on Clouds deployment versions] ***
ok: [localhost] =&gt; {
    "changed": false,
    "msg": "This operation playbook version and the Ansible on Clouds deployment version are identical: 2.4.20230606-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero means the Ansible on Clouds deployment version does not match the command_generator container and a different version is required for the command generator to manage that deployment.</p>
</div>
<h4 id="_gcp_health_check" class="discrete">gcp_health_check</h4>
<div class="paragraph">
<p>This playbook checks if the nodes and Ansible application are healthy.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_health_check</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_health_check
Description: This playbook checks if the Ansible Automation Platform from GCP Marketplace deployment is healthy.
-----------------------------------------------
The health check consists of checking the Ansible Automation Platform from GCP Marketplace heatlh checks
and the health of the monitoring exporter.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_health_check [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters will generate a new command to launch and will output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=47   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero indicates an issue with nodes or the Ansible on Cloud deployment.</p>
</div>
<h4 id="_gcp_list_deployments" class="discrete">gcp_list_deployments</h4>
<div class="paragraph">
<p>This playbook list the deployments, the region and zone are optional.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_list_deployments</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_list_deployments
Description: This playbook generates a list of available Ansible Automation Platform from GCP Marketplace deployments.
-----------------------------------------------
This playbook is used to generate a list of available Ansible Automation Platform from GCP Marketplace deployments.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_list_deployments -c &lt;cloud_credentials_path&gt; --extra-vars '[gcp_compute_region=&lt;gcp_compute_region&gt;] [gcp_compute_zone=&lt;gcp_compute_zone&gt;]'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
TASK [Show deployment list] ****************************************************
ok: [localhost] =&gt; {
    "msg": [
        "Deployment list: ['dep1', 'dep2', 'dep3']"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<h4 id="_gcp_nodes_health_check" class="discrete">gcp_nodes_health_check</h4>
<div class="paragraph">
<p>This playbook checks if the nodes are healthy.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_nodes_health_check</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_nodes_health_check
Description: This role runs a health check on a group of nodes in the Ansible Automation Platform from GCP Marketplace deployment
-----------------------------------------------
The playbook checks if the Ansible Automation Platform from GCP Marketplace monitoring exporter is up and running.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_nodes_health_check [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'check_monitoring=True'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=47   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
<div class="paragraph">
<p>A <em>failed</em> not equal zero indicates an issue with nodes in the deployment.</p>
</div>
<h4 id="_gcp_remove_labels" class="discrete">gcp_remove_labels</h4>
<div class="paragraph">
<p>This playbook removes labels from the deployment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm $IMAGE command_generator_vars gcp_remove_labels</pre>
</div>
</div>
<div class="paragraph">
<p>Which generates the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_remove_labels
Description: This playbook removes labels from the deployment.
-----------------------------------------------
Remove labels from the Ansible Automation Platform from GCP Marketplace deployment.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_remove_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_labels=&lt;gcp_labels&gt;'
===============================================</pre>
</div>
</div>
<div class="paragraph">
<p>The parameter <code>gcp_labels</code> is a comma separated list of keys to remove.</p>
</div>
<div class="paragraph">
<p>Launching this command by replacing the parameters generates a new command to launch and outputs:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-automation-workloads"><a class="anchor" href="#assembly-gcp-automation-workloads"></a>6. Automation workloads</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default Ansible Automation Platform from GCP Marketplace deployment is designed and licensed to automate 100 managed nodes.</p>
</div>
<div class="sect2">
<h3 id="ref-gcp-automation-performance"><a class="anchor" href="#ref-gcp-automation-performance"></a>6.1. Automation performance</h3>
<div class="paragraph">
<p>Automating against your licensed managed node allocation in the offer is provided with the following operational expectations.
Automating outside of the boundaries of these criteria is not supported, but can still function depending on your automation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Metric</th>
<th class="tableblock halign-left valign-top">Threshold</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Concurrent Jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forks per job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is driven using three n2-standard-2 instances, two of which run automation controller and one which runs automation hub.
The automation controller instances collectively support a standard workload for 100 managed active nodes.
Red Hat has tested this and proved that there is support for up to 10 forks each.
This operating criteria has been set and tested using output-intensive, “chatty” workloads that produce 2 messages 7 seconds apart on both automation controller nodes.
Workloads that are more I/O intensive might not work inside the boundaries of these conditions and can require the use of extension nodes to scale the deployment to support such automation. For further information, see <a href="#proc-gcp-extension-nodes">Purchasing an extension node</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ref-gcp-deployment-scaling"><a class="anchor" href="#ref-gcp-deployment-scaling"></a>6.2. Deployment scaling</h3>
<div class="paragraph">
<p>If you want to scale your deployment beyond the initial number of supported managed nodes, Ansible Automation Platform from GCP Marketplace can be manually scaled using separately sold extension nodes.</p>
</div>
<div class="paragraph">
<p>Extension nodes are additional compute instances that can be deployed to scale-up or scale-out depending on the immediate scaling requirements.
If your requirements are for higher parallel automation operations you can select compute shapes that scale-up, while if you have a requirement to automate more nodes over time you can select compute shapes that scale out.</p>
</div>
<div class="paragraph">
<p>Extension nodes are the supported way of extending the capabilities of Ansible Automation Platform from GCP Marketplace.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Environments that are extended through customer design and implementation are not supported by Red Hat.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-extension-nodes"><a class="anchor" href="#proc-gcp-extension-nodes"></a>6.3. Purchasing an extension node</h3>
<div class="paragraph">
<p>The extension node offering enables you to add additional Ansible managed node licenses and additional compute VMs into your Ansible Automation Platform from GCP Marketplace deployment.</p>
</div>
<div class="paragraph">
<p>Extension nodes for Red Hat Ansible Automation Platform from GCP Marketplace can be obtained directly from the Google Marketplace.
Follow these steps to purchase and deploy the public offer.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Google Cloud Console, navigate to the <a href="https://console.cloud.google.com/marketplace">Marketplace</a>.</p>
</li>
<li>
<p>In the <strong>Search Marketplace</strong> text box, search for <strong>Ansible Automation Platform</strong>.</p>
</li>
<li>
<p>Click one of the listings for <strong>Extension Node - Ansible Automation Platform</strong>.
Depending on your needs, select 100, 200 or 400 Managed Nodes.</p>
</li>
<li>
<p>Ensure that you have selected the offer where Red Hat is the publisher.</p>
</li>
<li>
<p>Review the details, and click btn:[LAUNCH].</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can purchase private offers for extension nodes through your Red Hat account executive.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-monitoring-logging"><a class="anchor" href="#assembly-gcp-monitoring-logging"></a>7. Monitoring and logging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can send metrics to the Google Cloud Platform monitoring system to be visualized in the Google Cloud Platform UI.
Ansible Automation Platform from GCP Marketplace metrics and logging are disabled by default as there is a cost to send these metrics to GCP.
Refer to <a href="https://cloud.google.com/stackdriver/pricing#monitoring-costs">Cloud Monitoring</a> and <a href="https://cloud.google.com/stackdriver/pricing">Cloud Logging</a> respectively for more information.</p>
</div>
<div class="paragraph">
<p>You can set up GCP monitoring and logging either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At deployment time, read <a href="#con-gcp-setup-at-deployment-time">Setting up monitoring and logging at deployment time</a>, or</p>
</li>
<li>
<p>After the deployment</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="con-gcp-setup-after-deployment"><a class="anchor" href="#con-gcp-setup-after-deployment"></a>7.1. Setting up monitoring and logging after deployment</h3>
<div class="paragraph">
<p>You can start or stop the logging and monitoring after the deployment by using the <code>gcp_setup_logging_monitoring</code> playbook available from registry.redhat.com.</p>
</div>
<div class="sect3">
<h4 id="con-gcp-use-container-image"><a class="anchor" href="#con-gcp-use-container-image"></a>7.1.1. Pulling the ansible-on-clouds-ops container image</h4>
<div class="paragraph">
<p>Pull the Docker image for the Ansible on Clouds operational container which aligns with the version of your foundation deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, if your foundation deployment version is 2.4.20230630-00, you must pull the operational image with tag 2.4.20230630.</p>
</div>
<div class="paragraph">
<p>Use the following commands:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
<div class="paragraph">
<p>For EMEA regions (Europe, Middle East, Africa) run the following command instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-emea-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-generate-variables"><a class="anchor" href="#proc-gcp-generate-variables"></a>7.1.2. Generating data files by running the ansible-on-clouds-ops container</h4>
<div class="paragraph">
<p>The following commands generate the required data file.
These commands create a directory, and  an empty data template that, when populated, is used to generate the playbook.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a folder to hold the configuration files.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>command_generator_data</code> folder with the configuration file template.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_setup_logging_monitoring \
--output-data-file /data/logging-monitoring.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Creates the following command file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_setup_logging_monitoring
Description: This playbook setup the logging and monitoring.
-----------------------------------------------
Install monitoring tools and configure them to send data to the Google Cloud Monitoring service.
-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator \
gcp_setup_logging_monitoring --data-file /data/logging-monitoring.yml</pre>
</div>
</div>
</li>
<li>
<p>When you have run these commands, a <code>command_generator_data/logging-monitoring.yml</code> template file is created.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the following example file, <code>ansible_config_path</code> is optional.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This template file resembles the following:-</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_setup_logging_monitoring:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    components:
    default_collector_interval:
    logging_enabled:
    monitoring_enabled:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-set-monitoring-logging-yml"><a class="anchor" href="#proc-gcp-set-monitoring-logging-yml"></a>7.1.3. Updating the data file</h4>
<div class="paragraph">
<p>If you do not require a parameter, remove that parameter from the configuration file.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Edit the <code>command_generator_data/logging-monitoring.yml</code> file and set the following parameters:</p>
</li>
<li>
<p><code>ansible_config_path</code> is used by default as the standard configuration for the <code>ansible-on-cloud offering</code> but if you have extra requirements in your environment you can specify your own.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the absolute path toward your credentials.
This must be an absolute path.</p>
</li>
<li>
<p><code>deployment_name</code> is the name of the deployment.</p>
</li>
<li>
<p><code>components</code> is an array containing the type of component where you want to do the setup.
The default is [ “controller”, “hub” ] which means that the logging monitoring will be enabled on both automation controller and automation hub.</p>
</li>
<li>
<p><code>monitoring_enabled</code> is set to <code>true</code> to enable the monitoring, <code>false</code> otherwise. Default = <code>false</code>.</p>
</li>
<li>
<p><code>logging_enabled</code> is set to <code>true</code> to enable the logging, <code>false</code> otherwise. Default = <code>false</code>.</p>
</li>
<li>
<p><code>default_collector_interval</code> is the periodicity at which the monitoring data must be send to the Google Cloud.
Default = 59s.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Google cost of this service depends on that periodicity and so the higher the value of the collector interval, the less it will cost.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Do not set values less than 59 seconds.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If monitoring and logging is disabled, the value of 'default_collector_interval' is automatically set to <code>0</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-generate-playbook"><a class="anchor" href="#proc-gcp-generate-playbook"></a>7.1.4. Generating the playbook</h4>
<div class="paragraph">
<p>To generate the playbook, run the command generator to generate the CLI command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_setup_logging_monitoring \
--data-file /data/logging-monitoring.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Provides the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_setup_logging_monitoring -e 'gcp_deployment_name=&lt;deployment_name&gt; \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  monitoring_enabled=&lt;monitoring_enabled&gt; \
logging_enabled=&lt;logging_enabled&gt; default_collector_interval=&lt;interval&gt;'</pre>
</div>
</div>
<div class="paragraph">
<p>Run the supplied command to run the playbook.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=GCP -v /path/to/credentials:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=mu-deployment \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_setup_logging_monitoring \
-e 'gcp_deployment_name=mu-deployment \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  components=["hubs","controllers"]\
monitoring_enabled=True logging_enabled=True default_collector_interval=60s'</pre>
</div>
</div>
<div class="paragraph">
<p>The process may take some time, and provides output similar to the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.setup_logging_monitoring : Update runtime variable logging_enabled] ***
changed: [&lt;user_name&gt; -&gt; localhost]

TASK [redhat.ansible_on_clouds.setup_logging_monitoring : Update runtime variable monitoring_enabled] ***
changed: [&lt;user_name&gt; -&gt; localhost]

PLAY RECAP *********************************************************************
&lt;user_name&gt;     : ok=20   changed=6    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-customize-monitoring-logging"><a class="anchor" href="#con-gcp-customize-monitoring-logging"></a>7.2. Customizing monitoring and logging</h3>
<div class="paragraph">
<p>Metrics are provided by <a href="https://docs.ansible.com/automation-controller/latest/html/administration/metrics.html">Ansible</a>, <a href="https://github.com/containers/prometheus-podman-exporter">Podman</a> and <a href="https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent">Google Ops Agent</a>.
Ansible metrics is only installed on automation hub, the Google Ops Agent and Podman are also installed on automation controllers.</p>
</div>
<div class="paragraph">
<p>A configurable process (collector) runs on each automation controller and automation hub to export the collected Ansible and Podman metrics to Google Cloud Platform Monitoring.
As the Google Ops Agent is part of the Google Cloud solution, it has its own configuration file.</p>
</div>
<div class="paragraph">
<p>The Google Ops Agent is also responsible for the logging configuration.</p>
</div>
<div class="paragraph">
<p>The service APIs <code>monitoring.googleapis.com</code> and <code>logging.googleapis.com</code> must be respectively enabled for the monitoring and logging capabilities.</p>
</div>
<div class="paragraph">
<div class="title">Configuration</div>
<p>Configuration files are located on a disk shared by each automation controller and automation hub.
Modify the file <code>/aap/bootstrap/config_file_templates/&lt;controller|hub&gt;/monitoring.yml</code> to configure all exporters and agents.</p>
</div>
<div class="sect3">
<h4 id="ref-gcp-ansible-podman-config"><a class="anchor" href="#ref-gcp-ansible-podman-config"></a>7.2.1. Ansible and podman configuration</h4>
<div class="paragraph">
<p>The file <code>/aap/bootstrap/config_file_templates/&lt;controller|hub&gt;/monitoring.yaml</code> on automation controller or automation hub contains the configuration for collecting and sending Ansible and podman metrics to GCP.</p>
</div>
<div class="paragraph">
<p>The default configuration for automation controller looks like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># This value will be set at deployment time.
# Set to zero if monitoringEnabled is false otherwise 59s
# The collection interval for each collector will be the minimum
# between the defaultCollectorInterval and all send Interval
# of a given collector
# NB: The awx exported should not run on controllers as
# it duplicates the number of records sent to GCP Monitoring

defaultCollectorInterval: $DEFAULT_COLLECTOR_INTERVAL
collectors:
- name: podman
 endpoint: http://localhost:9882/podman/metrics
 enabled: true

# list of metrics to exclude
# excludedMetrics:
# - podman_container_created_seconds

 metrics:
 - name: podman_container_exit_code
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s</pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration for automation hub looks like:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># This value will be set at deployment time.
# Set to zero if monitoringEnabled is false otherwise 59s
# The collection interval for each collector will be the minimum
# between the defaultCollectorInterval and all sendInterval
# of a given collector
# NB: The awx exporter should not run on controllers as
# it duplicates the number of records sent to GCP Monitoring

defaultCollectorInterval: 59s
collectors:
- name: awx
 userName: admin
 endpoint: http://&lt;Controller_LB_IP&gt;/api/v2/metrics/
 enabled: true
 metrics:
 - name: awx_inventories_total
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s
- name: podman
 endpoint: http://localhost:9882/podman/metrics
 enabled: true

# list of metrics to exclude
#  excludedMetrics:
#  - podman_container_created_seconds

 metrics:
 - name: podman_container_exit_code
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s</pre>
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="paragraph">
<p><code>collectors</code> is a configuration array with one item per collector, that is, awx and podman.</p>
</div>
<div class="paragraph">
<p>The awx collector requires authentication and so <code>userName</code> must be set to <code>admin</code>.
The password is retrieved from the secret-manager.</p>
</div>
<div class="paragraph">
<p>The endpoint should not be changed.</p>
</div>
<div class="paragraph">
<p><code>defaultCollectorInterval</code> specifies the default interval at which the exporter collects the information from the metric end-point and sends it to Google Cloud Platform Monitoring.</p>
</div>
<div class="paragraph">
<p>Setting this value to <code>0</code> or omitting this attribute disables all collectors.</p>
</div>
<div class="paragraph">
<p>Each collector can be enabled or disabled separately by setting <code>enabled</code> to <code>true</code> or <code>false</code>.</p>
</div>
<div class="paragraph">
<p>A collector returns all available metrics grouped by families, but you can exclude the families that should not be sent to Google Cloud Platform Monitoring by adding their name in the array <code>excludedMetrics</code>.</p>
</div>
<div class="paragraph">
<p>For all other family metrics, you can specify the interval at which you want to collect and send them to the Google Cloud Platform Monitoring.
The collector interval is the minimum between all family metrics interval and the <code>defaultCollectorInterval</code>.
This to ensure that a collection is made for each set of metrics sent to Google Cloud Platform Monitoring.</p>
</div>
</div>
<div class="sect3">
<h4 id="ref-gcp-configure-google-cloud-ops-agent"><a class="anchor" href="#ref-gcp-configure-google-cloud-ops-agent"></a>7.2.2. Google cloud ops agent configuration</h4>
<div class="paragraph">
<p>The configuration file details can be found <a href="https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/configuration">here</a>.</p>
</div>
<div class="paragraph">
<p>The configuration file is located in <code>/etc/google-cloud-ops-agent/config.yml</code>.</p>
</div>
<div class="paragraph">
<p>This is a symbolic link to the shared disk <code>/aap/bootstrap/config_file_templates/controller/gcp-ops-agent-config.yml</code> or <code>/aap/bootstrap/config_file_templates/hub/gcp-ops-agent-config.yml</code> depending on the component type.</p>
</div>
<div class="paragraph">
<p>The configuration file contains a number of receivers specifying what should be collected by the ops agent.</p>
</div>
<div class="paragraph">
<p>Your selection of <strong>Connect Logging</strong> and <strong>Connect Metrics</strong> during deployment determines which pipelines are included in the file and therefore which logs and metrics are collected and sent to GCP.</p>
</div>
<div class="paragraph">
<p>If you need to add more pipelines post-deployment, you can insert them in <code>/aap/bootstrap/config_file_templates/hub|controller/gcp-ops-agent-config.yml</code>.</p>
</div>
<div class="paragraph">
<p>A crontab job restarts the agent if <code>gcp-ops-agent-config.yml</code> changed in the last 10 minutes.
The agent rereads its configuration after a restart.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-uninstall"><a class="anchor" href="#assembly-gcp-uninstall"></a>8. Uninstalling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how to uninstall Ansible Automation Platform from GCP Marketplace.</p>
</div>
<div class="sect2">
<h3 id="proc-gcp-uninstall-application-uninstall"><a class="anchor" href="#proc-gcp-uninstall-application-uninstall"></a>8.1. Uninstalling the application</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This action cannot be reversed.</p>
</div>
<div class="paragraph">
<p>If a Load Balancer was added for the deployment, it must be deleted before uninstalling the deployment.</p>
</div>
<div class="paragraph">
<p>If extension nodes were added to the deployment, they must also be deleted before uninstalling the deployment. Follow the instructions in <a href="#proc-gcp-delete-extension-nodes">Removing extension nodes</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Deployment Manager</strong>.
If you do not see <strong>Deployment Manager</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Tick the checkbox in front of the deployment to be deleted.</p>
</li>
<li>
<p>Click btn:[Delete] in the top bar.
This action cannot be reversed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The deployment is deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-extension-nodes"><a class="anchor" href="#proc-gcp-delete-extension-nodes"></a>8.2. Deleting Extension Nodes</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This action cannot be reversed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Extension nodes are created as deployments in GCP Deployment Mananger. As such, the process to delete an Ansible Automation Platform extension node is the same as the process to delete the main Ansible Automation Platform deployment.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu.</p>
</li>
<li>
<p>Select <strong>Deployment Manager</strong>.
If you do not see <strong>Deployment Manager</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Check the checkbox for the extension node you want to delete.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Extension nodes and the main deployment are both found in <strong>Deployment Manager</strong>. Ensure that you select the extension node and not the main deployment. The name of the extension node was chosen by the person that created it.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click btn:[Delete] in the top bar.
This action cannot be reversed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The extension node is deleted.</p>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-administration-secret"><a class="anchor" href="#proc-gcp-delete-administration-secret"></a>8.3. Deleting the administration secret</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Security</strong>. If you do not see <strong>Security</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Secret Manager</strong>.</p>
</li>
<li>
<p>The format of the secret name is <code>&lt;DeploymentName&gt;-aap-admin</code>. Filter using this name.</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the deployment.</p>
</li>
<li>
<p>Select <strong>Delete</strong>.</p>
</li>
<li>
<p>The administration password is displayed.</p>
</li>
<li>
<p>Enter the name of the secret.</p>
</li>
<li>
<p>Click btn:[Delete Secret].</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-service-account"><a class="anchor" href="#proc-gcp-delete-service-account"></a>8.4. Deleting the service account</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If a new service account was created for the deployment and if it is not used anywhere else, it can be deleted</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>IAM &amp; Admin</strong>. If you do not see <strong>IAM &amp; Admin</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Service Accounts</strong>.</p>
</li>
<li>
<p>Filter with the name of the service account.</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the service account.</p>
</li>
<li>
<p>Select <strong>Delete</strong>.</p>
</li>
<li>
<p>The administration password is displayed.</p>
</li>
<li>
<p>Click btn:[Delete].</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-upgrade-secrets"><a class="anchor" href="#proc-gcp-delete-upgrade-secrets"></a>8.5. Deleting secrets left over after upgrade, backup and restore</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This action cannot be reversed.</p>
</div>
<div class="paragraph">
<p>Only perform this action if your deployment is deleted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are several possible secret names you can find, depending on the procedures you have completed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>&lt;deployment_name&gt;</em>-aap-secret-key</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-aap-admin</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-container_auth_private_key_pem</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-container_auth_public_key_pem</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-database_fields_symmetric_key</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-pulp_cert</p>
</li>
<li>
<p><em>&lt;deployment_name&gt;</em>-pulp_key</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Security</strong>. If you do not see <strong>Security</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Secret Manager</strong>.</p>
</li>
<li>
<p>Search your deployment name, looking for the names in the list above.</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the deployment.</p>
</li>
<li>
<p>Select <strong>Delete</strong>.
The administration password is displayed.</p>
</li>
<li>
<p>Enter the name of the secret.</p>
</li>
<li>
<p>Click <strong>Delete Secret</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-backup-leftovers"><a class="anchor" href="#proc-gcp-delete-backup-leftovers"></a>8.6. Deleting the filestore after backup</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This action cannot be reversed.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Procedure</p>
</li>
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Filestore</strong>. If you do not see <strong>Filestore</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Backups</strong>.</p>
</li>
<li>
<p>The format of the backup name is <code>&lt;DeploymentName&gt;-filestore-&lt;RandomSufix&gt;</code>.
Filter using this name.</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the deployment.</p>
</li>
<li>
<p>Select <strong>Delete</strong>.</p>
</li>
<li>
<p>The administration password is displayed.</p>
</li>
<li>
<p>Enter the name of the secret.</p>
</li>
<li>
<p>Click btn:[Delete Backup].</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="proc-gcp-delete-object-storage"><a class="anchor" href="#proc-gcp-delete-object-storage"></a>8.7. Deleting the object storage bucket after backup</h3>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Select the main menu from the top left.</p>
</li>
<li>
<p>Select <strong>Cloud Storage</strong>. If you do not see <strong>Cloud Storage</strong>, select <strong>View All Products</strong>.</p>
</li>
<li>
<p>Select <strong>Buckets</strong>.</p>
</li>
<li>
<p>Search for your deployment name.</p>
</li>
<li>
<p>Click the btn:[More Actions] icon <strong>&vellip;</strong> on the line of the deployment.</p>
</li>
<li>
<p>Select <strong>Delete</strong>.</p>
</li>
<li>
<p>The administration password is displayed.</p>
</li>
<li>
<p>Enter the name of the secret.</p>
</li>
<li>
<p>Click btn:[Delete Secret].</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-aap-gcp-backup-and-recovery"><a class="anchor" href="#assembly-aap-gcp-backup-and-recovery"></a>9. Backup and Restore</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>You must restore with the same operational image version as the backup.</p>
</li>
<li>
<p>You can only restore using a new VPC network.
Backup and restore into an existing VPC network is not currently supported.</p>
</li>
<li>
<p>You cannot delete the backed up environment before a restore because the database backups are stored in the deployment.
Deleting your deployment therefore deletes the database backups.</p>
</li>
<li>
<p>Versioned or point-in-time backups are not supported by the <code>ansible-on-clouds-op</code> container.
Only the most recent backup of a deployment is used to restore the deployment.</p>
</li>
<li>
<p>To backup and restore your Ansible Automation Platform deployment, it is vital to have your existing Ansible Automation Platform administration secret name and value recorded somewhere safe.</p>
</li>
<li>
<p>It is also important to take regular manual backups of the Cloud SQL database instance and filestore backups, to ensure a deployment can be restored as close as possible to its previous working state.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The playbooks backup and restore provides backup and restore support for the Ansible Automation Platform from GCP Marketplace foundation deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The restore process deploys a new Ansible Automation Platform with the filestore and SQL database instance being restored to the specified backup.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="con-gcp-backup-process"><a class="anchor" href="#con-gcp-backup-process"></a>9.1. The Backup Process</h3>
<div class="paragraph">
<p>A backup enables you to backup your environment by saving the database and the shared file system.
A new environment is created during the restore using the saved shared file system.
When the new environment is in place, the process restores the database.</p>
</div>
<div class="paragraph">
<p>The backup and restore process must use the same version.
If you performed the backup with an earlier version, you must use the restore process of that version.
Then, if required, you can run an upgrade.</p>
</div>
<div class="paragraph">
<p>You must also make a backup before an upgrade.
For further information, read <a href="#assembly-gcp-upgrade">Upgrading your deployment</a></p>
</div>
<div class="paragraph">
<p>The backup process involves taking a backup of the Cloud SQL database and filestore instances at a given point in time.
The backup playbook requires an active Ansible Automation Platform from GCP Marketplace foundation deployment to be running.</p>
</div>
<div class="paragraph">
<p>A bucket needs to be created in your project as restore information will be stored in that bucket.</p>
</div>
<div class="paragraph">
<p>The bucket can contain multiple backups from the same deployment or different ones. A backup will generate a directory named &lt;prefix&gt;-&lt;deployment_name&gt;-&lt;timestamp&gt; and a file named &lt;prefix&gt;-&lt;deployment_name&gt;-&lt;timestamp&gt;.json. The directory contains the awx and pulp databases backup, the deployment configuration and the secrets. The json file contains information for the restore procedure.</p>
</div>
<div class="paragraph">
<p>Playbooks are provided through the CLI to list and delete backups.</p>
</div>
<div class="paragraph">
<p>The following procedures describe how to backup the Ansible Automation Platform from GCP Marketplace deployment.</p>
</div>
<div class="sect3">
<h4 id="proc-gcp-upgrade-pull-container-image_backup"><a class="anchor" href="#proc-gcp-upgrade-pull-container-image_backup"></a>9.1.1. Pulling the ansible-on-clouds-ops container image</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pull the docker image for the <code>ansible-on-clouds-ops</code> container with the same tag as the foundation deployment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For EMEA regions (Europe, Middle East, Africa) run the following command instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-emea-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-setup-environment_backup"><a class="anchor" href="#proc-gcp-setup-environment_backup"></a>9.1.2. Setting up the environment</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a folder to hold the configuration files.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-backup-requirements"><a class="anchor" href="#proc-gcp-backup-requirements"></a>9.1.3. Backup requirements</h4>
<div class="paragraph">
<p>You must create a bucket to store the Ansible on Clouds deployment backup.
The bucket contains the backup information, the secrets and the databases backups.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the Google Cloud console, navigate to menu:Cloud Storage[Buckets]</p>
</li>
<li>
<p>Choose the project.</p>
</li>
<li>
<p>Click btn:[Create].</p>
</li>
<li>
<p>Enter a name.</p>
</li>
<li>
<p>Enter the data location that fits the most your requirements. Multi and Dual regions enable you to run a restore to another region.</p>
</li>
<li>
<p>Enter the storage class that fits the most your requirements.</p>
</li>
<li>
<p>Enter the control access that fits the most your requirements.</p>
</li>
<li>
<p>Enter the data protection that fits the most your requirements.</p>
</li>
<li>
<p>Click btn:[Create]</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Troubleshooting</div>
<p>An error is raised if the bucket name is already used in another project.</p>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-create-data-file"><a class="anchor" href="#proc-gcp-create-data-file"></a>9.1.4. Creating the backup data file</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Populate the <code>command_generator_data</code> directory with the configuration file template.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backup_deployment --output-data-file /data/backup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Produces the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE \
command_generator_vars gcp_backup_deployment --output-data-file /data/backup.yml

===============================================
Playbook: gcp_backup_deployment
Description: This playbook is used to backup the Ansible Automation Platform from GCP Marketplace environment.
-----------------------------------------------
This playbook is used to backup the Ansible Automation Platform from GCP Marketplace environment.
For more information regarding backup and restore, visit our official documentation -
https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-gcp-backup-and-restore
-----------------------------------------------</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE \
command_generator_vars gcp_backup_deployment --output-data-file /data/backup.yml</pre>
</div>
</div>
</li>
<li>
<p>After running the command, a <code>/tmp/backup.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_backup_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    backup_prefix: aoc-backup
    gcp_bucket_backup_name:
    gcp_compute_region:
    gcp_compute_zone:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-gcp-populate-backup-file"><a class="anchor" href="#ref-gcp-populate-backup-file"></a>9.1.5. Parameters in the backup.yml file</h4>
<div class="paragraph">
<p>You must populate the data file before triggering the backup.
The following variables are parameters listed in the data file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cloud_credentials_path</code> is the path for your Google Cloud service account credentials file.
This must be an absolute path.</p>
</li>
<li>
<p><code>deployment_name</code> is the name of the AAP deployment manager deployment you want to back up.</p>
</li>
<li>
<p><code>backup_prefix</code> is a prefix you would like to add to the backup name (default: aoc-backup)</p>
</li>
<li>
<p><code>gcp_bucket_backup_name</code> is the bucket that was previously created to use for the backup.</p>
</li>
<li>
<p><code>gcp_compute_region</code> is GCP region where the foundation deployment is deployed.
This can be retrieved by checking the Deployments config in Deployment Manager.</p>
</li>
<li>
<p><code>gcp_compute_zone</code> is the GCP zone where the foundation deployment is deployed.
This can be retrieved by checking the Deployments config in Deployment Manager.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-run-backup-playbook"><a class="anchor" href="#proc-gcp-run-backup-playbook"></a>9.1.6. Running the backup playbook</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To run the backup, run the command generator to generate the backup command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following ouput:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v  &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_prefix=aoc-backup'</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied backup command to trigger the backup.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=GCP -v  &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_prefix=aoc-backup'</pre>
</div>
</div>
</li>
<li>
<p>When the playbook has finished running, the output resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_backup : [backup_deployment] Print the variable required to restore deployment my-deployment] ***
ok: [localhost] =&gt; {
    "msg": [
        "AAP on GCP Backup successful. Please note below the bucket name and backup name which are required for restore process.",
        "gcp_bucket_backup_name: my-bucket",
        "backup_name: aoc-backup-my-deployment-20230616T134002"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=38   changed=6    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-listing-backups-playbook"><a class="anchor" href="#proc-gcp-listing-backups-playbook"></a>9.1.7. List backups</h4>
<div class="paragraph">
<p>This playbook enables you to list the existing backups in a specific bucket.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Populate the <code>command_generator_data</code> directory with the configuration file template.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backup_list --output-data-file /data/backups_list.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Produces the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">Playbook: gcp_backup_list
Description: This playbook list the backups in a given bucket.
-----------------------------------------------
This playbook list the backups in a given bucket.

-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator gcp_backup_list --data-file /data/backups_list.yml</pre>
</div>
</div>
</li>
<li>
<p>After running the command, a <code>/tmp/backups_list.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_backup_list:
  cloud_credentials_path:
  extra_vars:
    gcp_bucket_backup_name:</pre>
</div>
</div>
</li>
<li>
<p>To run the backup, run the command generator to generate the backup command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backup_list --data-file /data/backups_list.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following ouput:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_backups_delete \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_bucket_backup_name=&lt;bucket&gt; \
backup_names=&lt;backup_names&gt; delete=True'</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied backup command to trigger the list of backups.</p>
</li>
<li>
<p>When the playbook has finished running, the output resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_backup_list : [list_backup] Display list of backups] ***
ok: [localhost] =&gt; {
    "msg": [
        "aoc-backup-deployment1-20230614T203926",
        "aoc-backup-deployment1-20230616T114134",
        "aoc-backup-deployment1-20230616T134002",
        "aoc-backup-deployment2-20230613T124127"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-deleting-backups-playbook"><a class="anchor" href="#proc-gcp-deleting-backups-playbook"></a>9.1.8. Delete backups</h4>
<div class="paragraph">
<p>There are two possible ways to delete backups:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <code>gcp_backup_delete</code> playbook which deletes a single backup.</p>
</li>
<li>
<p>Use the <code>gcp_backups_delete</code> playbook which deletes multiple backups at once.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>gcp_backups_delete</code> takes a array of strings ["backup1","backup2",&#8230;&#8203;], while <code>gcp_backup_delete</code> takes only one string, that being the name of a specific backup, "backup1".</p>
</div>
<div class="paragraph">
<p>The use of <code>gcp_backups_delete</code> is described in this section.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Populate the <code>command_generator_data</code> directory with the configuration file template.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backups_delete --output-data-file /data/backups.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Produces the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE \
command_generator_vars gcp_backup_delete --output-data-file /data/backup.yml

===============================================
Playbook: gcp_backups_delete
Description: This playbook delete a list of backups.
-----------------------------------------------
This playbook delete a list of backups

-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator gcp_backups_delete --data-file /data/backups.yml</pre>
</div>
</div>
</li>
<li>
<p>After running the command, a <code>/tmp/backups.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_backups_delete:
  cloud_credentials_path:
  extra_vars:
    backup_names:
    delete:
    gcp_bucket_backup_name:</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>With backup_names like ["backup1","backup2"]</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To run the backup, run the command generator to generate the backup command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backups_delete --data-file /data/backups.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Resulting in the following ouput:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_backups_delete \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_bucket_backup_name=&lt;bucket&gt; \
backup_names=&lt;backup_names&gt; delete=True'</pre>
</div>
</div>
</li>
<li>
<p>Run the supplied backup command to trigger the backup.</p>
</li>
<li>
<p>When the playbook has finished running, the output resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_backup_delete : [delete_backup] Dry-run message] ***
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=23   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-deleting-backups-troubleshooting-playbook"><a class="anchor" href="#proc-gcp-deleting-backups-troubleshooting-playbook"></a>9.1.9. Fixing a failed backup deletion</h4>
<div class="paragraph">
<p>If the deletion of a backup failed, take the following actions:</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Navigate to the bucket containing the backup.</p>
</li>
<li>
<p>Locate the directory that has the name of the backup.</p>
</li>
<li>
<p>Open the backup directory.</p>
</li>
<li>
<p>Delete the directory with the name of the backup.</p>
</li>
<li>
<p>Delete the file with the backup name with <code>.json</code> as extension.</p>
</li>
<li>
<p>Navigate to menu:Filestore[Backup].</p>
</li>
<li>
<p>Delete the Filestore backup with the same name as the backup.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-restore-process"><a class="anchor" href="#con-gcp-restore-process"></a>9.2. Restore Process</h3>
<div class="paragraph">
<p>The restore process creates a new deployment, and restores the filestore and SQL database instance to the specified backup.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>You must restore with the same operational image version which was used for the backup.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following procedures describe how to restore the Ansible Automation Platform from GCP Marketplace deployment.</p>
</div>
<div class="sect3">
<h4 id="proc-gcp-upgrade-pull-container-image_restore"><a class="anchor" href="#proc-gcp-upgrade-pull-container-image_restore"></a>9.2.1. Pulling the ansible-on-clouds-ops container image</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pull the docker image for the <code>ansible-on-clouds-ops</code> container with the same tag as the foundation deployment.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For EMEA regions (Europe, Middle East, Africa) run the following command instead:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-emea-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-setup-environment_restore"><a class="anchor" href="#proc-gcp-setup-environment_restore"></a>9.2.2. Setting up the environment</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a folder to hold the configuration files.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ mkdir command_generator_data</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-generate-restore-yml-file"><a class="anchor" href="#proc-gcp-generate-restore-yml-file"></a>9.2.3. Generating the restore.yml file</h4>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the command generator <code>command_generator_vars`</code> to generate <code>restore.yml</code>.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator_vars gcp_restore_deployment --output-data-file /data/restore.yml</pre>
</div>
</div>
<div class="paragraph">
<p>Providing the following output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">===============================================
Playbook: gcp_restore_deployment
Description: This playbook is used to restore the Ansible Automation Platform from GCP Marketplace environment from a backup.
-----------------------------------------------
This playbook is used to restore the Ansible Automation Platform from GCP Marketplace environment from a backup.
For more information regarding backup and restore, visit our official documentation -
https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-aap-gcp-backup-and-recovery

-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml</pre>
</div>
</div>
<div class="paragraph">
<p>The template resembles the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_restore_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    backup_name:
    gcp_bucket_backup_name:
    gcp_cloud_sql_peering_network:
    gcp_compute_region:
    gcp_compute_zone:
    gcp_controller_internal_ip_address:
    gcp_existing_vpc:
    gcp_filestore_ip_range:
    gcp_hub_internal_ip_address:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="“ref-gcp-populate-restore-file”"><a class="anchor" href="#“ref-gcp-populate-restore-file”"></a>9.2.4. Parameters of the restore.yml file</h4>
<div class="paragraph">
<p>You can only restore into a new VPC network.</p>
</div>
<div class="paragraph">
<div class="title">For a new VPC</div>
<p>If you want to restore using a new VPC set the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gcp_existing_vpc</code> must be set to <code>false</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following parameters must be removed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gcp_filestore_ip_range</code></p>
</li>
<li>
<p><code>gcp_cloud_sql_peering_network</code></p>
</li>
<li>
<p><code>gcp_controller_internal_ip_address</code></p>
</li>
<li>
<p><code>gcp_hub_internal_ip_address</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Provide values for the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gcp_existing_vpc</code> must be set to <code>false</code>.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path for your Google Cloud service account credentials file.</p>
</li>
<li>
<p><code>deployment_name</code> is the name under which the deployment must be restored. A new deployment will be created with this name. A deployment must not already exist with this name.</p>
</li>
<li>
<p><code>gcp_bucket_backup_name</code> is the bucket name you used for the backup.</p>
</li>
<li>
<p><code>gcp_compute_region</code> is the region where the backup was taken.
This can be retrieved by checking the Deployments config in Deployment Manager.</p>
</li>
<li>
<p><code>gcp_compute_zone</code> is the zone where the backup was taken.
This can be retrieved by checking the Deployments config in Deployment Manager.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">For an existing VPC</div>
<p>If you want to restore using an existing VPC, you must set the parameters shown above.</p>
</div>
<div class="paragraph">
<p>You must also set the following additional parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gcp_existing_vpc</code> is set to <code>true</code>.</p>
</li>
<li>
<p><code>gcp_filestore_ip_range</code> must be set to a free ip/29 range of your VPC.
For example: 192.168.245.0/29.
You must not use 192.168.243.0/29 as this the default used when deploying Ansible Automation Platform from GCP Marketplace.</p>
</li>
<li>
<p><code>gcp_cloud_sql_peering_network</code> must be set to a free <code>/24</code> subnet.
You must not use 192.168.241.0/24 as this is used during the original deployment.</p>
</li>
<li>
<p><code>gcp_controller_internal_ip_address</code> must be set to a free IP in your VPC network.</p>
</li>
<li>
<p><code>gcp_hub_internal_ip_address</code> must set to a free IP in your VPC network.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-gcp-run-restore-command"><a class="anchor" href="#ref-gcp-run-restore-command"></a>9.2.5. Running the restore command</h4>
<div class="paragraph">
<p>When <code>restore.yml</code> is populated, you can use the command generator to create the restore command.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the command generator.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As <code>/tmp</code> is used, the <code>&lt;local_data_file_directory&gt;</code> must be set to <code>/tmp</code> unless you chose a different location for <code>restore.yml</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This generates a new command containing all needed volumes, environment variables and parameters.</p>
</div>
<div class="paragraph">
<p>The generated command resembles the following:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">docker run --rm --env PLATFORM=GCP -v &lt;local_credential_file&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; --env GENERATE_INVENTORY=true -\
-env CHECK_GENERATED_INVENTORY=false  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=u&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_name=&lt;backup_name&gt;'</pre>
</div>
</div>
</li>
<li>
<p>Run the generated command.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=GCP -v &lt;local_credential_file&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;former_deployment_name&gt; gcp_restored_deployment_name=&lt;new_deployment_name&gt; \
gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; gcp_bucket_backup_name=&lt;bucket&gt; gcp_existing_vpc=False'</pre>
</div>
</div>
</li>
<li>
<p>When the playbook has completed, the output resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_restore : Display internal IP addresses] ***
ok: [localhost] =&gt;
  msg:
  - 'Hub        internal IP: 192.168.240.21'
  - 'Controller internal IP: 192.168.240.20'

PLAY RECAP *********************************************************************
localhost                  : ok=33   changed=8    unreachable=0    failed=0    skipped=6    rescued=0    ignored=2</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-failed-to-restore"><a class="anchor" href="#ref-failed-to-restore"></a>9.2.6. Failure to restore</h4>
<div class="paragraph">
<p>If a message similar to the following appears during the restore, you must contact support as the restore must be done manually.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_restore : [restore_deployment] Restore awx db] <strong>*</strong>
fatal: [localhost -&gt; dvernier-restore1-aap-cntrlr-x2c6]: FAILED!</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-upgrade"><a class="anchor" href="#assembly-gcp-upgrade"></a>10. Upgrading</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can upgrade your existing Ansible Automation Platform deployment to the newer version.
The upgrade process covers upgrading the automation hub, automation controller, and extension nodes.
The upgrade process takes roughly the same amount of time as a Ansible Automation Platform deployment install.
You are required to create a backup before running the upgrade.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace supports sequential upgrades.
All upgrades should be no more than one major version behind the version you are currently upgrading to.
For example, to upgrade Ansible Automation Platform to 2.4.20230630, you must be on version 2.3.20230221.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Docker must be installed to run the upgrade playbook.</p>
</li>
<li>
<p>A Linux or macOS system, where the <code>ansible-on-clouds-ops</code> container image will run.</p>
</li>
<li>
<p>The upgrade process requires several volumes to be mounted. Prepare a fresh directory to be used for this process.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following procedures form the upgrade process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backup your Ansible Automation Platform 2.3 stack.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-aap-gcp-backup-and-recovery#con-gcp-backup-process">Ansible on Clouds 2.3 backup instructions</a>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Upgrade Ansible Automation Platform</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Pull the ansible-on-clouds-ops 2.4 container image</p>
</li>
<li>
<p>Ensure minimum required permissions are met</p>
</li>
<li>
<p>Generate the data file</p>
</li>
<li>
<p>Update the data file</p>
</li>
<li>
<p>Begin upgrading Ansible Automation Platform by running the operational container</p>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) Restore the stack from a backup.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-aap-gcp-backup-and-recovery#con-gcp-restore-process">Ansible on Clouds 2.3 restore instructions</a>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="con-gcp-upgrade-backup-process"><a class="anchor" href="#con-gcp-upgrade-backup-process"></a>10.1. Backup before upgrade</h3>
<div class="paragraph">
<p>Before beginning the upgrade of your Ansible Automation Platform environment, it is first required to take a backup of your environment at its current version.</p>
</div>
<div class="paragraph">
<p>To backup your Ansible Automation Platform environment at the earlier version, follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-aap-gcp-backup-and-recovery#con-gcp-backup-process">Ansible on Clouds 2.3 backup instructions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-upgrade-upgrading"><a class="anchor" href="#con-gcp-upgrade-upgrading"></a>10.2. Upgrade Ansible Automation Platform</h3>
<div class="sect3">
<h4 id="proc-gcp-upgrade-pull-container-image"><a class="anchor" href="#proc-gcp-upgrade-pull-container-image"></a>10.2.1. Pulling the ansible-on-clouds-ops container image</h4>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Pull the Docker image for Ansible on Clouds operational container with the same tag as the version you want to upgrade to.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker login registry.redhat.io</pre>
</div>
</div>
<div class="paragraph">
<p>For more information about registry login, see <a href="https://access.redhat.com/RegistryAuthentication">Registry Authentication</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Ansible on Clouds operational image tag must match the version that you want to upgrade to. For example, if your foundation deployment version is 2.3.20230221, pull the operational image with tag 2.4.20230630 to upgrade to version 2.4.20230630.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel8:2.4.20230630
$ docker pull $IMAGE --platform=linux/amd64</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="ref-aws-iam-upgrade-minimum-permissions"><a class="anchor" href="#ref-aws-iam-upgrade-minimum-permissions"></a>10.2.2. Required permissions</h4>
<div class="paragraph">
<p>You must have the following GCP IAM permissions to upgrade the stack:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">required-roles:
  - Service Account User
  - Compute Instance Admin (v1)
required-permissions:
  - compute.healthChecks.update
  - compute.healthChecks.use
  - compute.healthChecks.useReadOnly
  - compute.regionBackendServices.update
  - iap.tunnelInstances.accessViaIAP
  - runtimeconfig.variables.get
  - secretmanager.locations.get
  - secretmanager.locations.list
  - secretmanager.secrets.create
  - secretmanager.secrets.delete
  - secretmanager.secrets.get
  - secretmanager.secrets.list
  - secretmanager.secrets.update
  - secretmanager.versions.access
  - secretmanager.versions.add
  - secretmanager.versions.disable
  - secretmanager.versions.enable
  - secretmanager.versions.get
  - secretmanager.versions.list</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-generate-upgrade-data-file"><a class="anchor" href="#proc-gcp-generate-upgrade-data-file"></a>10.2.3. Generating the data file</h4>
<div class="paragraph">
<p>The commands in this section create a directory and populate it with an empty data template that, when populated, is used during the upgrade.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Run the following commands to generate the required data file.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap"># Create a folder to hold the configuration files
$ mkdir command_generator_data</pre>
</div>
</div>
</li>
<li>
<p>Populate the <code>command_generator_data</code> folder with the configuration file template.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_upgrade \
--output-data-file /data/extra_vars.yml</pre>
</div>
</div>
</li>
<li>
<p>After running these commands, a <code>command_generator_data/extra_vars.yml</code> template file is created.
This template file resembles the following:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_upgrade:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_backup_taken:
    gcp_compute_region:
    gcp_compute_zone:</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="ref-gcp-update-upgrade-data-file"><a class="anchor" href="#ref-gcp-update-upgrade-data-file"></a>10.2.4. Updating the data file</h4>
<div class="paragraph">
<p>You must populate the data file before triggering the upgrade. Each parameter is required unless it is noted as optional. If the parameter is noted as optional, both its key and value can be removed from the data file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ansible_config_path</code> (Optional) Only use if overriding with a custom <code>ansible_config</code>.</p>
</li>
<li>
<p><code>cloud_credentials_path</code> is the path to your GCP credentials file.</p>
</li>
<li>
<p><code>deployment_name</code> is the name of the foundation deployment.</p>
<div class="ulist">
<ul>
<li>
<p>This is the same name you used when you deployed the foundation.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>gcp_backup_taken</code> is the verification that a manual backup of the current deployment was recently created prior to running this upgrade.
Use <code>true</code> here to verify a recent backup was created.</p>
</li>
<li>
<p><code>gcp_compute_region</code> is the GCP region that you provided when deploying foundation deployment.
If you have not provided a region when deploying the foundation, use the default region <code>us-east1</code> here.</p>
</li>
<li>
<p><code>gcp_compute_zone</code> is the GCP zone that you provided when deploying foundation deployment.
If you have not provided a zone when deploying the foundation, use the default <code>us-east1-b</code> here.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After populating the data file, it should resemble the following.</p>
</div>
<div class="paragraph">
<p>The following values are provided as examples:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">gcp_upgrade:
  ansible_config_path:
  cloud_credentials_path: ~/secrets/GCP-secrets.json
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    gcp_backup_taken: true
    gcp_compute_region: us-east1
    gcp_compute_zone: us-east1-b</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proc-gcp-running-upgrade"><a class="anchor" href="#proc-gcp-running-upgrade"></a>10.2.5. Running the upgrade playbook</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To run the upgrade, run the command generator to generate the upgrade CLI command:</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre>
</div>
</div>
<div class="paragraph">
<p>This generates the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">-----------------------------------------------
docker run --rm --env PLATFORM=GCP -v ~/secrets/GCP-secrets.json:/home/runner/.gcp/credentials:ro
--env ANSIBLE_CONFIG=../gcp-ansible.cfg
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_upgrade \
-e 'gcp_deployment_name=AnsibleAutomationPlatform \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials \
gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b gcp_backup_taken=True'
===============================================</pre>
</div>
</div>
</li>
<li>
<p>Run the given upgrade command to trigger the upgrade.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm --env PLATFORM=GCP -v ~/secrets/GCP-secrets.json:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_upgrade \
-e 'gcp_deployment_name=AnsibleAutomationPlatform \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials \
gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b gcp_backup_taken=True'</pre>
</div>
</div>
</li>
<li>
<p>The upgrade can take some time to complete, but can take longer depending on the number of extension nodes on the system.
A successful upgrade is marked by the log below.</p>
<div class="literalblock">
<div class="content">
<pre class="nowrap">TASK [redhat.ansible_on_clouds.standalone_gcp_upgrade : [upgrade] Show GCP current version] ***
ok: [localhost] =&gt; {
    "msg": "gcp_current_version: 2.3.20230221-00"
}</pre>
</div>
</div>
</li>
<li>
<p>Your Ansible Automation Platform from GCP Marketplace deployment is now upgraded to a newer version and you can log in to Red Hat Ansible Automation Platform automation controller and automation hub using your deployment credentials.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="con-gcp-upgrade-restore-from-stack"><a class="anchor" href="#con-gcp-upgrade-restore-from-stack"></a>10.3. Restore from backup</h3>
<div class="paragraph">
<p>If you would like to restore the earlier version of your Ansible Automation Platform environment to the state it was in before the upgrade, follow the <a href="https://access.redhat.com/documentation/en-us/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/assembly-aap-gcp-backup-and-recovery#con-gcp-restore-process">Ansible on Clouds 2.3 restore instructions</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="assembly-gcp-support"><a class="anchor" href="#assembly-gcp-support"></a>11. Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is a self-managed deployment.
When the application is deployed into your GCP infrastructure, customers are responsible for the maintenance of the GCP infrastructure and Ansible Automation Platform patching.
However, Red Hat does not support any changes to the infrastructure resources deployed as part of the solution unless there is documentation by Red Hat to do so, such as in route table configuration for networking or documented upgrade processes.
Adding additional compute resources outside of extension nodes voids Red Hat support for the Ansible Automation Platform from GCP Marketplace deployment.</p>
</div>
<div class="sect2">
<h3 id="ref-gcp-vm-image-packages"><a class="anchor" href="#ref-gcp-vm-image-packages"></a>11.1. VM Image packages</h3>
<div class="paragraph">
<p>Ansible Automation Platform from GCP Marketplace is delivered through virtual machines that are based on a VM image produced by the Red Hat Ansible team.
This image contains packages from Red Hat and Google in order to properly function on Google Cloud Platform and run Red Hat Ansible Automation Platform.
The image contains the following Google packages and containers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.8571%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-osconfig-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Google OS Configuration Agent uses the management service to deploy, query, and maintain consistent configurations, that is, the desired state and software for your VM instance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>google-cloud-ops-agent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Ops Agent is the primary agent for collecting telemetry from your Compute Engine instances.
Combining logging and metrics into a single agent, the Ops Agent uses Fluent Bit for logs, which supports high-throughput logging, and the OpenTelemetry Collector for metrics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gce-proxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Cloud SQL Authorization proxy is used to connect Ansible Automation Platform components with the Cloud SQL database using the virtual machine service account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gcloud CLI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The gcloud command line interface is used to configure the Ansible Automation Platform installation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Upgrades, including package updates and CVE patches, will be provided as new VM images through the GCP Marketplace.
Red Hat operates within its premium support policies for providing updated machine images to Red Hat Ansible Automation Platform from GCP Marketplace, and will provide upgrade instructions to customers when upgradable machine images are available.</p>
</div>
</div>
<div class="sect2">
<h3 id="ref-gcp-supported-changes"><a class="anchor" href="#ref-gcp-supported-changes"></a>11.2. Supported infrastructure configuration changes</h3>
<div class="paragraph">
<p>Red Hat supports changes to the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>VPC Route Configuration</p>
</li>
<li>
<p>VPC Firewall Configuration</p>
</li>
<li>
<p>VPC Load Balancer Configuration</p>
</li>
<li>
<p>Block Storage Expansion</p>
</li>
<li>
<p>DNS and <code>resolv.conf</code> files</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Red Hat Responsibilities</div>
<p>Red Hat has the following responsibilities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Premium support for Ansible Automation Platform.</p>
</li>
<li>
<p>Directions and how-to processes for upgrading Ansible Automation Platform from GCP Marketplace.</p>
<div class="ulist">
<ul>
<li>
<p>Provided through knowledge base articles when upgrades are published.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Customer Responsibilities</div>
<p>You have the following responsibilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GCP Infrastructure Uptime</p>
</li>
<li>
<p>GCP Infrastructure Changes (ex: increasing block storage sizes)</p>
</li>
<li>
<p>GCP Network Peering and Configuration</p>
</li>
<li>
<p>Backing up Ansible data from GCP databases and file storageResources</p>
</li>
<li>
<p>Application of Ansible Automation Platform upgrades</p>
<div class="ulist">
<ul>
<li>
<p>Upgrade instructions will be provided at upgrade time through Red Hat Knowledge Base articles.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-07-06 17:58:53 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>